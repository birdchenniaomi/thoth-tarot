<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=0.5, user-scalable=yes">
    <title>3D æ‰˜ç‰¹å¡”ç¾…ï¼šçµ‚æ¥µä¿®æ­£ç‰ˆ</title>
    <style>
        :root {
            --card-w: 80px; --card-h: 130px;
            --gold: #d4af37;
            --bg-major: #8A8A8A;
            --bg-cups: #1075B5;
            --bg-wands: #942712;
            --bg-disks: #AD7E28;
            --bg-swords: #2BCCC4;
        }
        @media (min-width: 768px) { :root { --card-w: 90px; --card-h: 145px; } }
        body {
            background: #CC9016; color: #e0e0e0; height: 100vh; margin: 0;
            overflow: hidden; font-family: "PingFang TC", sans-serif;
            display: flex; flex-direction: column; align-items: center;
            touch-action: pan-x pan-y pinch-zoom;
        }
        .stars-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(ellipse at bottom, #342063 0%, #090A0F 100%);
            z-index: -1;
        }
        .star { position: absolute; background: white; border-radius: 50%; opacity: 0.3; animation: twinkle var(--t) infinite ease-in-out; }
        @keyframes twinkle { 0%, 100% { opacity: 0.3; transform: scale(1); } 50% { opacity: 1; transform: scale(1.2); } }
        
        #mainCanvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center;
            will-change: transform; transition: transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .controls { margin-top: 2vh; text-align: center; z-index: 100; }
        .btn-reset {
            margin-top: 10px; padding: 8px 25px; background: rgba(0,0,0,0.6);
            color: var(--gold); border: 1px solid var(--gold); cursor: pointer;
            border-radius: 30px; transition: 0.3s; backdrop-filter: blur(5px);
        }
        .btn-reset:hover { background: var(--gold); color: #000; box-shadow: 0 0 15px var(--gold); }
        
        .table { position: relative; width: 100vw; height: 250px; perspective: 1200px; display: flex; justify-content: center; align-items: center; margin-top: 10px; }
        .slot-container { display: flex; gap: 30px; margin-top: 20px; z-index: 1; pointer-events: none; }
        .slot { width: var(--card-w); height: var(--card-h); border: 1px dashed rgba(212, 175, 55, 0.3); border-radius: 8px; }
        
        .card {
            position: absolute; width: var(--card-w); height: var(--card-h);
            cursor: grab; transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1), filter 0.3s;
            touch-action: none; -webkit-tap-highlight-color: transparent;
        }
        
        .card.flipping { animation: flip-squeeze 0.3s ease-in-out forwards; }
        @keyframes flip-squeeze {
            0% { transform: translate(var(--tx), var(--ty)) rotateZ(var(--rz)) scaleX(1) rotateY(0deg); }
            50% { transform: translate(var(--tx), var(--ty)) rotateZ(var(--rz)) scaleX(0.2) rotateY(90deg); }
            100% { transform: translate(var(--tx), var(--ty)) rotateZ(0deg) scaleX(1) rotateY(180deg); }
        }

        .card.flash { filter: brightness(1.8) drop-shadow(0 0 10px #fff); }
        .card-face { position: absolute; width: 100%; height: 100%; border-radius: 8px; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; text-align: center; padding: 12px; box-sizing: border-box; }
        .card-back { background: #4A3204; border: 2px solid #737373; z-index: 2; --pattern-content: "ğ–¤“"; }
        .card-back::after { content: var(--pattern-content, "ğ–¤“"); color: var(--gold); opacity: 0.4; font-size: 70px; }
        
        .card-order {
            position: absolute; top: 5px; left: 5px; background: rgba(0,0,0,0.85);
            color: var(--gold); width: 22px; height: 22px; border-radius: 50%;
            font-size: 12px; line-height: 22px; text-align: center;
            border: 1px solid var(--gold); z-index: 10; display: none;
            transition: transform 0.3s;
        }
        .card[data-flipped="true"] .card-order { transform: rotateY(180deg); }

        .card-front {
            color: #111; transform: rotateY(180deg);
            font-weight: bold; font-size: 1rem; border: 4px double var(--gold);
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            animation: gold-breathe 3s infinite ease-in-out;
            z-index: 1;
        }
        .card-front.major { background: var(--bg-major); }
        .card-front.cups { background: var(--bg-cups); }
        .card-front.wands { background: var(--bg-wands); }
        .card-front.disks { background: var(--bg-disks); }
        .card-front.swords { background: var(--bg-swords); }
        
        @keyframes gold-breathe {
            0%, 100% { border-color: var(--gold); box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
            50% { border-color: #fff7d1; box-shadow: 0 0 20px rgba(212, 175, 55, 0.8); }
        }
        .dragging { transition: none !important; z-index: 2000 !important; }

        #tooltip {
            position: absolute; background: rgba(0, 0, 0, 0.85); color: #e0e0e0;
            padding: 12px 16px; border-radius: 10px; border: 1px solid var(--gold);
            font-size: 0.8rem; line-height: 1.5; width: 280px; max-width: 90vw;
            box-sizing: border-box; pointer-events: none; opacity: 0; transition: opacity 0.3s;
            z-index: 3000; backdrop-filter: blur(5px); box-shadow: 0 0 15px rgba(212, 175, 55, 0.4);
            word-wrap: break-word;
        }
        #tooltip.visible { opacity: 1; }
        #tooltip h4 { margin: 8px 0 4px; color: var(--gold); font-size: 1rem; }
        #tooltip p { margin: 4px 0; }

        #deckPanelToggle {
            position: fixed; left: 10px; top: 20px;
            padding: 10px 6px; background: rgba(0,0,0,0.8); color: var(--gold);
            border: 1px solid var(--gold); border-radius: 0 10px 10px 0;
            cursor: pointer; z-index: 400; writing-mode: vertical-rl; font-size: 1rem;
            backdrop-filter: blur(5px); display: none;
            min-width: 35px;
        }
        #deckPanel {
            position: fixed; left: -300px; top: 0; width: 300px; height: 100%; background: rgba(0,0,0,0.95);
            border-right: 1px solid var(--gold); z-index: 350; transition: left 0.4s ease;
            padding: 20px 10px; box-sizing: border-box; overflow-y: auto; backdrop-filter: blur(10px);
        }
        #deckPanel.open { left: 0; }
        .cat-group { margin-bottom: 10px; border-bottom: 1px solid rgba(212,175,55,0.2); }
        .cat-title {
            width: 100%; padding: 12px; background: none; border: none; color: var(--gold);
            font-size: 1.1rem; font-weight: bold; text-align: left; cursor: pointer;
            display: flex; justify-content: space-between;
        }
        .cat-content { display: none; padding: 5px 0 15px 10px; flex-wrap: wrap; gap: 5px; }
        .cat-content.active { display: flex; }
        .card-btn {
            display: inline-block; width: 46%; margin: 2px; padding: 8px 5px;
            background: rgba(255,255,255,0.05); color: #e0e0e0; border: 1px solid #444;
            border-radius: 4px; cursor: pointer; text-align: center; font-size: 0.85rem;
        }
        .card-btn:hover { background: var(--gold); color: #000; border-color: var(--gold); }
        
        .custom-options {
            margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(212,175,55,0.2);
        }
        .custom-options h3 {
            color: var(--gold); font-size: 1rem; margin: 15px 0 10px; text-align: center;
        }
        .option-group {
            margin-bottom: 15px;
        }
        .option-label {
            color: #e0e0e0; font-size: 0.9rem; margin-bottom: 8px; display: block;
        }
        .color-options {
            display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;
        }
        .color-btn {
            width: 40px; height: 40px; border: 2px solid #666; border-radius: 6px;
            cursor: pointer; transition: transform 0.2s, border-color 0.2s;
        }
        .color-btn:hover { transform: scale(1.1); border-color: var(--gold); }
        .color-btn.active { border-color: var(--gold); border-width: 3px; box-shadow: 0 0 10px rgba(212,175,55,0.5); }
        .pattern-options {
            display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;
        }
        .pattern-btn {
            width: 50px; height: 50px; border: 2px solid #666; border-radius: 6px;
            cursor: pointer; transition: transform 0.2s, border-color 0.2s;
            background: #4A3204; color: var(--gold); font-size: 24px; display: flex;
            align-items: center; justify-content: center; opacity: 0.4;
        }
        .pattern-btn:hover { transform: scale(1.1); border-color: var(--gold); opacity: 0.7; }
        .pattern-btn.active { border-color: var(--gold); border-width: 3px; opacity: 0.6; box-shadow: 0 0 10px rgba(212,175,55,0.5); }
    </style>
</head>
<body>
    <div class="stars-container" id="stars"></div>
    <div id="mainCanvas">
        <div class="controls">
            <h2 style="margin:0; color:var(--gold); letter-spacing: 2px; text-shadow: 0 0 8px rgba(212,175,55,0.5);">é³¥å’ªæ‰˜ç‰¹æŠ½ç‰Œ TAROT</h2>
            <p id="hint" style="margin:5px 0; color: #aaa; font-size: 0.9rem;">é»æ“Šç‰Œå †å±•é–‹ (é›™æŒ‡æ‹–å‹•/ç¸®æ”¾æ¡Œé¢)</p>
            <button class="btn-reset" onclick="resetGame()">é‡æ–°æ´—ç‰Œ</button>
        </div>
        <div class="table" id="cardTable"></div>
        <div class="slot-container">
            <div class="slot"></div>
            <div class="slot"></div>
            <div class="slot"></div>
        </div>
    </div>
    <div id="tooltip"></div>
    <div id="deckPanelToggle">>></div>
    <div id="deckPanel"></div>

    <script>
        const thothCards = ["0 æ„šè€…", "I é­”è¡“å¸«", "II å¥³æ•™çš‡", "III çš‡å", "IV çš‡å¸", "V æ•™çš‡", "VI æˆ€äºº", "VII æˆ°è»Š", "VIII æ­£ç¾©", "IX éš±å£«", "X å‘½é‹ä¹‹è¼ª", "XI åŠ›é‡", "XII å€’åŠäºº", "XIII æ­»äº¡", "XIV ç¯€åˆ¶", "XV æƒ¡é­”", "XVI é«˜å¡”", "XVII æ˜Ÿæ˜Ÿ", "XVIII æœˆäº®", "XIX å¤ªé™½", "XX æ°¸æ†", "XXI å®‡å®™", "æ¬Šæ–é¨å£«", "æ¬Šæ–çš‡å", "æ¬Šæ–ç‹å­", "æ¬Šæ–å…¬ä¸»", "æ¬Šæ–1", "æ¬Šæ–2", "æ¬Šæ–3", "æ¬Šæ–4", "æ¬Šæ–5", "æ¬Šæ–6", "æ¬Šæ–7", "æ¬Šæ–8", "æ¬Šæ–9", "æ¬Šæ–10", "è–æ¯é¨å£«", "è–æ¯çš‡å", "è–æ¯ç‹å­", "è–æ¯å…¬ä¸»", "è–æ¯1", "è–æ¯2", "è–æ¯3", "è–æ¯4", "è–æ¯5", "è–æ¯6", "è–æ¯7", "è–æ¯8", "è–æ¯9", "è–æ¯10", "å¯¶åŠé¨å£«", "å¯¶åŠçš‡å", "å¯¶åŠç‹å­", "å¯¶åŠå…¬ä¸»", "å¯¶åŠ1", "å¯¶åŠ2", "å¯¶åŠ3", "å¯¶åŠ4", "å¯¶åŠ5", "å¯¶åŠ6", "å¯¶åŠ7", "å¯¶åŠ8", "å¯¶åŠ9", "å¯¶åŠ10", "åœ“ç›¤é¨å£«", "åœ“ç›¤çš‡å", "åœ“ç›¤ç‹å­", "åœ“ç›¤å…¬ä¸»", "åœ“ç›¤1", "åœ“ç›¤2", "åœ“ç›¤3", "åœ“ç›¤4", "åœ“ç›¤5", "åœ“ç›¤6", "åœ“ç›¤7", "åœ“ç›¤8", "åœ“ç›¤9", "åœ“ç›¤10"];

        const cardMeanings = {
            "0 æ„šè€…": { general: "æ½›èƒ½ã€å†’éšªã€æ–°çš„èµ·é»", work: "å‰µæ„å°ˆæ¡ˆã€ä¸æŒ‰ç‰Œç†å‡ºç‰Œ", love: "è¿½æ±‚è‡ªç”±ã€éš¨æ€§ç™¼å±•", health: "æ´»åŠ›å……æ²›", reverse: "é­¯è½ã€ä¸è² è²¬ä»»" },
            "I é­”è¡“å¸«": { general: "æ„å¿—åŠ›ã€æºé€šã€æŒæ¡è³‡æº", work: "å‰µæ¥­ã€æºé€šå°ˆé•·", love: "é­…åŠ›ã€ä¸»å‹•å‡ºæ“Š", health: "ç²¾åŠ›æ—ºç››", reverse: "æ¬ºé¨™ã€æ“ç¸±" },
            "II å¥³æ•™çš‡": { general: "ç›´è¦ºã€æ½›æ„è­˜ã€å…§åœ¨æ™ºæ…§", work: "ç ”ç©¶ã€å¹•åƒšã€éœå¾…æ™‚æ©Ÿ", love: "æŸæ‹‰åœ–å¼æˆ€æƒ…", health: "å¿ƒç†å¥åº·", reverse: "æƒ…ç·’å£“æŠ‘ã€ç›´è¦ºå¤±æ•ˆ" },
            "III çš‡å": { general: "è±é¥’ã€æ»‹é¤Šã€æ„›èˆ‡ç¾", work: "è—è¡“å‰µä½œã€åœ˜éšŠé—œæ‡·", love: "ç†±æƒ…æµªæ¼«ã€æ‡·å­•", health: "ç”Ÿè‚²åŠ›å¼·", reverse: "å«‰å¦’ã€éåº¦ä¾è³´" },
            "IV çš‡å¸": { general: "çµæ§‹ã€æ¬Šå¨ã€ç©©å®šã€é ˜å°", work: "é«˜éšç®¡ç†ã€è¦å‰‡", love: "ç©©å®šçš„é—œä¿‚", health: "éª¨éª¼å¥åº·", reverse: "å°ˆåˆ¶ã€é ‘å›º" },
            "V æ•™çš‡": { general: "å‚³çµ±ã€æŒ‡å°ã€é“å¾·ã€é«”åˆ¶", work: "é¡§å•ã€æ•™è‚²ã€é«”åˆ¶å…§æˆåŠŸ", love: "å‚³çµ±å©šå§»", health: "å°ˆæ¥­é†«ç™‚", reverse: "åè¦‹ã€åå‚³çµ±" },
            "VI æˆ€äºº": { general: "é¸æ“‡ã€çµåˆã€å’Œè«§", work: "åˆå¤¥é—œä¿‚ã€é‡è¦æ±ºç­–", love: "éˆé­‚ä¼´ä¾¶ã€ç†±æˆ€", health: "èº«å¿ƒå¹³è¡¡", reverse: "é—œä¿‚ä¸å’Œã€éŒ¯èª¤æŠ‰æ“‡" },
            "VII æˆ°è»Š": { general: "å‹åˆ©ã€æ„å¿—åŠ›ã€å…‹æœå›°é›£", work: "å‡ºå·®ã€å‡è·ã€å‹åˆ©", love: "ç©æ¥µè¿½æ±‚", health: "æ¢å¾©å¼·å¥", reverse: "å¤±æ§ã€ä¾µç•¥æ€§" },
            "VIII æ­£ç¾©": { general: "å…¬å¹³ã€å¹³è¡¡ã€å› æœã€æ³•å¾‹", work: "åˆç´„ç°½ç½²ã€æ³•å¾‹äº‹å‹™", love: "é—œä¿‚å¹³è¡¡ã€èª å¯¦", health: "è…è‡Ÿå¥åº·", reverse: "ä¸å…¬ã€åè¦‹" },
            "IX éš±å£«": { general: "å…§çœã€å­¤ç¨ã€å°‹æ±‚çœŸç†", work: "ç¨ç«‹å·¥ä½œã€å°ˆæ‰", love: "å–®èº«è‡ªçœã€å…§åœ¨é€£çµ", health: "éœ€è¦éœé¤Š", reverse: "å­¤ç«‹ã€æ‹’çµ•å¹«åŠ©" },
            "X å‘½é‹ä¹‹è¼ª": { general: "é€±æœŸã€è®ŠåŒ–ã€å¥½é‹è½‰å‹•", work: "æ©Ÿæœƒé™è‡¨ã€è½‰æŠ˜é»", love: "å®¿å‘½èˆ¬çš„ç›¸é‡", health: "å¾ªç’°ç³»çµ±", reverse: "å£é‹ã€çªç™¼è®Šæ•…" },
            "XI åŠ›é‡": { general: "å‹‡æ°£ã€ç†±æƒ…ã€è€æ€§ã€éŸŒæ€§", work: "é ˜å°é­…åŠ›ã€èªªæœåŠ›", love: "æ¿€æƒ…ã€ä»¥æŸ”å…‹å‰›", health: "å¼·å¤§ç”Ÿå‘½åŠ›", reverse: "è»Ÿå¼±ã€æƒ…ç·’å¤±æ§" },
            "XII å€’åŠäºº": { general: "çŠ§ç‰²ã€é€†è½‰è¦–è§’ã€ç­‰å¾…", work: "éæ¸¡æœŸã€è½‰å‹æœŸ", love: "ç„¡ç§çš„æ„›ã€ç­‰å¾…", health: "è¡€æ¶²å¾ªç’°", reverse: "ç„¡è¬‚çŠ§ç‰²ã€åŸ·è¿·" },
            "XIII æ­»äº¡": { general: "çµæŸèˆ‡é‡ç”Ÿã€è›»è®Š", work: "è¾­è·ã€è¨ˆç•«çµ‚æ­¢ã€è½‰å‹", love: "åˆ†æ‰‹ã€é‡ç”Ÿ", health: "é‡å¤§åº·å¾©è½‰æŠ˜", reverse: "å®³æ€•æ”¹è®Šã€åœæ»¯" },
            "XIV ç¯€åˆ¶": { general: "èª¿å’Œã€å¹³è¡¡ã€ç™‚ç™’ã€æ•´åˆ", work: "å”èª¿ã€è·¨ç•Œåˆä½œ", love: "å’Œè«§å¹³ç©©çš„æ„Ÿæƒ…", health: "èº«é«”åº·å¾©ã€æ°´è…«", reverse: "å¤±å»å¹³è¡¡ã€æ¥µç«¯" },
            "XV æƒ¡é­”": { general: "æŸç¸›ã€æ…¾æœ›ã€æˆç™®ã€ç‰©è³ª", work: "æ¬ŠåŠ›é¬¥çˆ­ã€é‡‘éŒ¢èª˜æƒ‘", love: "æƒ…æ…¾æŸç¸›ã€ä¾è³´é—œä¿‚", health: "æ…¢æ€§ç—…ã€æˆç™®", reverse: "è§£æ”¾ã€è¦ºæ‚Ÿ" },
            "XVI é«˜å¡”": { general: "çªç™¼éœ‡é©šã€ç ´å£èˆŠçµæ§‹", work: "çªç™¼å±æ©Ÿã€è£å“¡", love: "é—œä¿‚å´©æ½°ã€çœŸç›¸å¤§ç™½", health: "çªç™¼æ„å¤–", reverse: "å»¶å¾Œå´©æ½°ã€é¿ç½" },
            "XVII æ˜Ÿæ˜Ÿ": { general: "å¸Œæœ›ã€éˆæ„Ÿã€ç™‚ç™’ã€å¯§éœ", work: "å‰æ™¯çœ‹å¥½ã€æ–°æ©Ÿæœƒ", love: "ç†æƒ³é—œä¿‚ã€é è·", health: "åº·å¾©ã€æ’æ¯’", reverse: "å¤±æœ›ã€æ‚²è§€" },
            "XVIII æœˆäº®": { general: "å¹»è¦ºã€ææ‡¼ã€æ½›æ„è­˜ä¸å®‰", work: "å±€å‹¢ä¸æ˜ã€é¢¨éšª", love: "ä¸å®‰ã€éš±çã€æ¬ºé¨™", health: "å¤±çœ ã€å¿ƒç†ä¸å®‰", reverse: "ææ‡¼æ¶ˆå¤±ã€çœŸç›¸æµ®ç¾" },
            "XIX å¤ªé™½": { general: "æˆåŠŸã€å–œæ‚…ã€æ´»åŠ›ã€å…‰æ˜", work: "å“è¶Šæˆå°±ã€ç²å¾—è‚¯å®š", love: "å¹¸ç¦å¹¸ç¦ã€ç†±æˆ€", health: "æ´»åŠ›å……æ²›", reverse: "æˆåŠŸå»¶é²ã€æš«æ™‚é™°éœ¾" },
            "XX æ°¸æ†": { general: "é‡ç”Ÿã€è¦ºé†’ã€é‡è¦åˆ¤æ–·", work: "ä½¿å‘½æ„Ÿã€é‡å¤§æ±ºç­–", love: "æ¥­åŠ›ç‰½å¼•ã€é‡æ–°å¯©è¦–", health: "åº·å¾©é‡ç”Ÿ", reverse: "æ‹’çµ•å¬å–šã€å»¶å®•" },
            "XXI å®‡å®™": { general: "åœ“æ»¿ã€å®Œæˆã€ä¸–ç•Œåœ¨è…³ä¸‹", work: "ç›®æ¨™é”æˆã€åœ‹éš›äº‹å‹™", love: "éˆé­‚çµåˆã€åœ“æ»¿", health: "èº«å¿ƒåˆä¸€", reverse: "åŠŸè™§ä¸€ç°£ã€æœªå®Œæˆ" },
            "æ¬Šæ–é¨å£«": { general: "ç†±æƒ…è¡Œå‹•ã€è¡å‹ã€æ€¥èº", work: "å¿«é€Ÿæ¨é€²ã€å‡ºå·®ã€æŒ‘æˆ°", love: "è¿½æ±‚åˆºæ¿€ã€é–ƒæˆ€", health: "ç«æ°£å¤§", reverse: "çˆ­åµã€åŠé€”è€Œå»¢" },
            "æ¬Šæ–çš‡å": { general: "è‡ªä¿¡ã€ç†±çƒˆã€ç£æ€§é­…åŠ›", work: "å¥³æ€§é ˜å°ã€å¼·åŠ›åŸ·è¡Œ", love: "ç¨ç«‹ä¸”è¿·äººçš„ä¼´ä¾¶", health: "å……æ»¿èƒ½é‡", reverse: "æ˜“æ€’ã€è‡ªæˆ‘ä¸­å¿ƒ" },
            "æ¬Šæ–ç‹å­": { general: "é–‹å‰µã€å‹‡çŒ›ã€é è¦‹", work: "é–‹å‰µå°ˆæ¡ˆã€çªç ´", love: "å¼·çƒˆçš„è¿½æ±‚", health: "é«”èƒ½å……æ²›", reverse: "æ®˜æš´ã€æ„å¿—è–„å¼±" },
            "æ¬Šæ–å…¬ä¸»": { general: "è¨Šæ¯ã€ç†±å¿±ã€ç„¡ç•", work: "æ–°é»å­ã€å‹‡æ•¢å˜—è©¦", love: "æ¢ç´¢æ–°é—œä¿‚", health: "æ–°ç”Ÿçš„æ´»åŠ›", reverse: "æƒ…ç·’åŒ–ã€é˜»ç¤™" },
            "æ¬Šæ–1": { general: "æ–°è¨ˆç•«çš„é–‹ç«¯ã€å‰µé€ åŠ›", work: "æ–°è·ä½ã€äº‹æ¥­èµ·é»", love: "æ¿€æƒ…çˆ†ç™¼", health: "ç”Ÿå‘½åŠ›çˆ†ç™¼", reverse: "è¨ˆç•«å¤­æŠ˜" },
            "æ¬Šæ–2": { general: "ä¸»æ¬Šã€çµ±å¾¡ã€é‡å¿ƒ", work: "æ“´å¼µã€æ±ºç­–ã€æŒæ§", love: "æŒæ§æ…¾ã€é—œä¿‚å”è­°", health: "è¡€å£“æ³¨æ„", reverse: "çŒ¶è±«ã€æ¬ŠåŠ›å–ªå¤±" },
            "æ¬Šæ–3": { general: "ç¾å¾·ã€åˆä½œã€å±•æœ›", work: "è²¿æ˜“ã€å‘å¤–ç™¼å±•ã€æˆåŠŸ", love: "å…±åŒç›®æ¨™", health: "è¦–åŠ›ã€è‚è‡Ÿ", reverse: "åˆä½œå¤±æ•—ã€çŸ­è¦–" },
            "æ¬Šæ–4": { general: "å®Œæ»¿ã€æ…¶ç¥ã€å’Œè«§", work: "ç©©å®šæ”¶ç©«ã€æ…¶åŠŸ", love: "å©šå§»ç©©å®šã€å®¶åº­ç¾æ»¿", health: "ä¼‘æ¯ã€æ”¾é¬†", reverse: "ç©©å®šå‹•æ–" },
            "æ¬Šæ–5": { general: "ç«¶çˆ­ã€è¡çªã€è§’é€", work: "è¾¦å…¬å®¤é¬¥çˆ­ã€æŒ‘æˆ°", love: "è§€å¿µæ‘©æ“¦", health: "ç–²å‹æ„Ÿ", reverse: "æ··äº‚åŠ åŠ‡" },
            "æ¬Šæ–6": { general: "å‹åˆ©ã€æˆåŠŸã€èªå¯", work: "ç²å¾—å¤§çã€ç›®æ¨™é”æˆ", love: "ä»¤äººç¨±ç¾¨çš„é€²å±•", health: "å¥åº·æ¢å¾©", reverse: "çŸ­æš«æˆåŠŸã€å—é˜»" },
            "æ¬Šæ–7": { general: "å‹‡æ°£ã€é˜²ç¦¦ã€å¥®æˆ°", work: "å…‹æœå¼·æ•µã€å®ˆä½ç«‹å ´", love: "ä¿è¡›æ„›æƒ…", health: "å…ç–«åŠ›æå‡", reverse: "å­¤ç«‹ç„¡æ´ã€é€€ç¸®" },
            "æ¬Šæ–8": { general: "è¿…æ·ã€å¿«é€Ÿé€²å±•ã€äº¤æµ", work: "è¡Œç¨‹ç·Šæ¹Šã€å¿«ç¯€å¥", love: "è¿…é€Ÿç™¼å±•ã€é æ–¹å‚³æƒ…", health: "ç¥ç¶“ç·Šå¼µ", reverse: "å»¶èª¤ã€é˜»ç¤™" },
            "æ¬Šæ–9": { general: "åŠ›é‡ã€è­¦è¦ºã€å®ˆå‚™", work: "é˜²ç¯„æœªç„¶ã€å …å¼·æ„å¿—", love: "å¿ƒç†é˜²ç¦¦ã€å …æŒ", health: "é«”åŠ›é€æ”¯", reverse: "é˜²ç·šå´©æ¯€" },
            "æ¬Šæ–10": { general: "å£“æŠ‘ã€æ²ˆé‡ã€è²¬ä»»", work: "éåº¦å‹ç´¯ã€è² æ“”éé‡", love: "é—œä¿‚æ²ˆé‡ã€ç–²æ†Š", health: "èƒŒéƒ¨å•é¡Œã€å£“åŠ›", reverse: "å´©æ½°ã€å¸è·" },
            "è–æ¯é¨å£«": { general: "å’Œå¹³ã€æ„›ã€æè­°", work: "è—è¡“å‰µä½œã€å’Œè«§æºé€š", love: "æµªæ¼«æ±‚å©šã€æ·±æƒ…", health: "æ³Œå°¿ç³»çµ±", reverse: "æ¿«æƒ…ã€ä¸åˆ‡å¯¦éš›" },
            "è–æ¯çš‡å": { general: "æº«æŸ”ã€æƒ…æ„Ÿã€åå°„", work: "å‚¾è½ã€ç›´è¦ºåˆ¤æ–·", love: "æ·±æ²‰çš„æƒ…æ„Ÿäº¤æµ", health: "å¿ƒç†å¹³è¡¡", reverse: "æƒ…ç·’åŒ–ã€æ†‚é¬±" },
            "è–æ¯ç‹å­": { general: "å¹³éœã€ç´°è†©ã€èª¿é©", work: "å¤–äº¤æ‰‹æ®µã€å†·éœè§€å¯Ÿ", love: "å…§æ–‚çš„æ„›", health: "èº«å¿ƒå”èª¿", reverse: "é™°éšªã€ä¸å¯ä¿¡" },
            "è–æ¯å…¬ä¸»": { general: "æº«æŸ”è¨Šæ¯ã€è©©æ„ã€å¤¢æƒ³", work: "éˆæ„Ÿã€è—è¡“èµ·é»", love: "ç´”æ½”çš„æ„›", health: "æ’æ¯’ã€æƒ…ç·’æµå‹•", reverse: "å¹»æ»…ã€æƒ…ç·’æ··äº‚" },
            "è–æ¯1": { general: "æƒ…æ„Ÿå……ç›ˆã€å¤§æ„›", work: "äº‹æ¥­å–œæ‚…ã€å’Œè«§é–‹ç«¯", love: "çœŸæ„›é™è‡¨", health: "æ’æ¯’åº·å¾©", reverse: "æƒ…æ„Ÿä¹¾æ¶¸" },
            "è–æ¯2": { general: "çµåˆã€åˆ†äº«ã€äº’æƒ ", work: "æ„‰å¿«åˆä½œã€ç°½ç´„", love: "å…©æƒ…ç›¸æ‚…ã€ç›¸è¦ª", health: "å¿ƒè¡€ç®¡å¹³è¡¡", reverse: "é—œä¿‚ç ´è£‚" },
            "è–æ¯3": { general: "è±è¶³ã€æ­¡æ…¶ã€æ”¯æŒ", work: "åœ˜éšŠæ…¶ç¥ã€ç¤¾äº¤ç´…åˆ©", love: "å¹¸ç¦ã€å¯èƒ½æœ‰ç¬¬ä¸‰è€…", health: "åº·å¾©", reverse: "ç¸±æ…¾éåº¦" },
            "è–æ¯4": { general: "å¥¢ä¾ˆã€ä¸æ»¿è¶³ã€åœæ»¯", work: "è·æ¥­å€¦æ€ ã€å­ç…©", love: "æƒ…æ„Ÿå†·æ·¡ã€å«Œæ£„", health: "æ¶ˆåŒ–ä¸è‰¯", reverse: "æ–°å‹•æ©Ÿã€è¦ºé†’" },
            "è–æ¯5": { general: "å¤±æœ›ã€éºæ†¾ã€æ‚²å‚·", work: "æœŸå¾…è½ç©ºã€æå¤±", love: "åˆ†æ‰‹ã€æƒ…å‚·", health: "ç²¾ç¥æ²®å–ª", reverse: "èµ°å‡ºé™°éœ¾" },
            "è–æ¯6": { general: "äº«æ¨‚ã€å›æ†¶ã€å–®ç´”", work: "èˆ’é©å€ã€å¾€æ—¥è³‡æº", love: "é’æ¢…ç«¹é¦¬ã€æº«æƒ…", health: "ç«¥å¹´ç–¾æ‚£", reverse: "æ²ˆæººéå»" },
            "è–æ¯7": { general: "æ”¾ç¸±ã€å¹»æƒ³ã€èª˜æƒ‘", work: "ä¸åˆ‡å¯¦éš›çš„è¨ˆç•«", love: "éœ²æ°´ç´…ç·£ã€è¿·æƒ˜", health: "å¹»è¦ºã€æ¯’å®³", reverse: "çœ‹æ¸…ç¾å¯¦" },
            "è–æ¯8": { general: "æ‡¶æƒ°ã€æ²ˆæººã€æ”¾æ£„", work: "å–ªå¤±é¬¥å¿—ã€é›¢è·", love: "å¿ƒç°æ„å†·ã€é›¢é–‹", health: "ç²¾æ°£ç¥åŒ±ä¹", reverse: "é‡æ‹¾å‹‡æ°£" },
            "è–æ¯9": { general: "å¹¸ç¦ã€æ»¿è¶³ã€ç‰©è³ªæ„Ÿå®˜", work: "äº‹æ¥­é«˜å³°ã€æ»¿æ„åº¦", love: "æƒ…æ„Ÿæ»¿è¶³", health: "å¥åº·è‰¯å¥½", reverse: "ç©ºè™›ã€è²ªå©ª" },
            "è–æ¯10": { general: "é£½æ»¿ã€åœ“æ»¿ã€å®¶æ—å’Œè«§", work: "ç†æƒ³åœ˜éšŠã€å®¶æ—äº‹æ¥­", love: "å©šå§»åœ“æ»¿ã€å¤§å®¶åº­", health: "å¿ƒæ»¿æ„è¶³", reverse: "å®¶åº­ç´›çˆ­" },
            "å¯¶åŠé¨å£«": { general: "æ•æ·å¿ƒæ™ºã€å°ˆæ³¨ã€åˆ‡å‰²", work: "ç²¾ç¢ºåˆ†æã€å±æ©Ÿè™•ç†", love: "ç›´æ¥ã€ç†æ€§ã€å†·é…·", health: "ç¥ç¶“ç—›", reverse: "åæ¿€ã€è¨€èªå‚·å®³" },
            "å¯¶åŠçš‡å": { general: "ç¿æ™ºã€ç¨ç«‹ã€ç©¿é€åŠ›", work: "å°ˆæ¥­é¡§å•ã€åš´è¬¹ç®¡ç†", love: "ç†æ€§çš„æ„›ã€è·é›¢æ„Ÿ", health: "é ­éƒ¨å•é¡Œ", reverse: "åˆ»è–„ã€å¿ƒç†é™°å½±" },
            "å¯¶åŠç‹å­": { general: "éˆæ´»ã€æ€è€ƒã€å®¢è§€", work: "æ–°ç†è«–ã€é‚è¼¯è¾¯è«–", love: "å¿ƒæ™ºäº¤æµã€ä¸ç©©å®š", health: "å‘¼å¸é“", reverse: "ç‹¡è©ã€æ€æƒ³æ··äº‚" },
            "å¯¶åŠå…¬ä¸»": { general: "è­¦è¦ºã€æ‰¹åˆ¤ã€è§€å¯ŸåŠ›", work: "è³‡è¨Šæ”¶é›†ã€èª¿æŸ¥", love: "æ‡·ç–‘ã€å¿ƒæ™ºæŒ‘æˆ°", health: "é˜²ç¦¦æ©Ÿåˆ¶", reverse: "é­¯è½ã€æƒ¡æ¯’æµè¨€" },
            "å¯¶åŠ1": { general: "ç†æ™ºå‹åˆ©ã€æ–°æ€è·¯", work: "æ±ºæ–·ã€çªç ´ç“¶é ¸", love: "ç†æ¸…é—œä¿‚", health: "å¤–ç§‘æ‰‹è¡“ã€æ¸…é†’", reverse: "æ··äº‚ã€æ¬ŠåŠ›æ¿«ç”¨" },
            "å¯¶åŠ2": { general: "å’Œå¹³ã€ä¼‘æˆ°ã€æ¬Šè¡¡", work: "åƒµå±€ã€å¦¥å”", love: "æƒ…æ„Ÿéº»æœ¨ã€æš«åœè¡çª", health: "è¦–åŠ›ã€å”èª¿", reverse: "å¤±è¡¡ã€çˆ­ç«¯çˆ†ç™¼" },
            "å¯¶åŠ3": { general: "æ†‚å‚·ã€åˆ†é›¢ã€å¿ƒç¢", work: "åˆå¤¥ç“¦è§£ã€æŒ«æŠ˜", love: "ä¸‰äººç³¾è‘›ã€åˆ†é›¢", health: "å¿ƒè‡Ÿå•é¡Œ", reverse: "å‚·ç—›æ¸›è¼•" },
            "å¯¶åŠ4": { general: "ä¼‘æˆ°ã€åº·å¾©ã€é¿é›£", work: "æš«æ™‚å¼•é€€ã€ä¼‘æ¯", love: "çµ¦å½¼æ­¤ç©ºé–“", health: "éœé¤ŠæœŸ", reverse: "å¼·åˆ¶å›æ­¸ç¾å¯¦" },
            "å¯¶åŠ5": { general: "å¤±æ•—ã€ææ‡¼ã€å‘å¾®", work: "æ…˜çƒˆé¬¥çˆ­ã€å¤±æ•—", love: "é—œä¿‚å±ˆè¾±", health: "å…ç–«ä½ä¸‹", reverse: "å¤±æ•—é‡ä¾†" },
            "å¯¶åŠ6": { general: "ç§‘å­¸ã€é‚è¼¯ã€éæ¸¡", work: "ç†æ€§çš„è§£æ±ºæ–¹æ¡ˆ", love: "å…±åŒåº¦éé›£é—œ", health: "å¿ƒç†è«®å•†", reverse: "æ··äº‚æƒ³æ³•" },
            "å¯¶åŠ7": { general: "å¾’å‹ã€çŒ¶è±«ã€è¨ˆè¬€", work: "ç§˜å¯†è¨ˆç•«ã€ç­–ç•¥éŒ¯èª¤", love: "ä¸çœŸèª ã€é€ƒé¿", health: "é›£ä»¥è¨ºæ–·", reverse: "å¦æ‰¿çœŸç›¸" },
            "å¯¶åŠ8": { general: "å¹²æ“¾ã€çŒ¶è±«ã€å—é™", work: "æ€ç·’æ··äº‚ã€ç„¡æ³•æ±ºå®š", love: "æƒ…æ„ŸæŸç¸›", health: "å¤±çœ ã€å¿ƒç†å›°å±€", reverse: "æ€ç·’æ¸…æ™°" },
            "å¯¶åŠ9": { general: "æ®˜é…·ã€çµ•æœ›ã€ç„¦æ…®", work: "é‡å¤§å£“åŠ›ã€è² ç½ªæ„Ÿ", love: "å™©å¤¢ã€æƒ…æ„ŸæŠ˜ç£¨", health: "å¿ƒç†å´©æ½°", reverse: "å¸Œæœ›å¾®ç¾" },
            "å¯¶åŠ10": { general: "æ¯€æ»…ã€çµ‚çµã€æ€æƒ³æ¥µé™", work: "äº‹æ¥­çµ‚çµã€å¾¹åº•ç ´ç”¢", love: "æ…˜çƒˆæ”¶å ´", health: "æ¥µåº¦è™›å¼±", reverse: "ç½®ä¹‹æ­»åœ°å¾Œç”Ÿ" },
            "åœ“ç›¤é¨å£«": { general: "è€å¿ƒã€æ”¶ç©«ã€å‹™å¯¦", work: "ç©©å®šçš„è²¡å‹™ã€å‹¤å¥®", love: "è¸å¯¦å®ˆè­·çš„æ„›", health: "ç‡Ÿé¤Šå‡è¡¡", reverse: "åå—‡ã€åœæ»¯" },
            "åœ“ç›¤çš‡å": { general: "ç¹æ¦®ã€æ¯æ€§ã€ç©©å®š", work: "è²¡å‹™ç®¡ç†ã€æˆåŠŸå¥³æ€§", love: "æº«æš–è¸å¯¦çš„é—œä¿‚", health: "èº«é«”å¼·å¥", reverse: "æ‡¶æƒ°ã€ç‰©è³ªåŒ–" },
            "åœ“ç›¤ç‹å­": { general: "æ²ˆç©©ã€æŒçºŒã€å°ˆæ³¨", work: "é•·ç·šæŠ•è³‡ã€å¯¦å‹™è€…", love: "å¯é çš„ä¼´ä¾¶", health: "é«”èƒ½è‰¯å¥½", reverse: "å›ºåŸ·ã€çŸ­è¦–" },
            "åœ“ç›¤å…¬ä¸»": { general: "æ½›åŠ›ã€å­•è‚²ã€æ–°ç”Ÿ", work: "æ–°äº‹æ¥­ç¨®å­ã€å¯¦ç¿’", love: "å­•è‚²ä¸­çš„æƒ…æ„Ÿ", health: "èº«é«”è®ŠåŒ–", reverse: "é˜»ç¤™ã€ç‰©è³ªåŒ±ä¹" },
            "åœ“ç›¤1": { general: "ç‰©è³ªè±è¶³ã€æ–°å•†æ©Ÿ", work: "è²¡å¯Œé–‹ç«¯ã€åŠ è–ª", love: "ç©©å®šçš„æ–°æˆ€æƒ…", health: "èº«é«”æ´»åŠ›", reverse: "éŒ¯å¤±è²¡é‹" },
            "åœ“ç›¤2": { general: "è®Šå‹•ã€å”èª¿ã€å¹³è¡¡", work: "è²¡å‹™èª¿åº¦ã€å…¼è·", love: "é©æ‡‰è®ŠåŒ–", health: "éˆæ´»æ€§", reverse: "å¤±è¡¡ã€è² å‚µ" },
            "åœ“ç›¤3": { general: "å·¥ä½œã€æŠ€èƒ½ã€å»ºæ§‹", work: "å°ˆæ¥­èªå¯ã€åŒ å¿ƒ", love: "å…±åŒç¶“ç‡Ÿç”Ÿæ´»", health: "èº«é«”å»ºè¨­", reverse: "ç²—è£½æ¿«é€ " },
            "åœ“ç›¤4": { general: "åŠ›é‡ã€æ“æœ‰ã€ä¿éšœ", work: "å®ˆæˆã€è³‡ç”¢ä¿å­˜", love: "ä½”æœ‰æ…¾ã€è¿½æ±‚å®‰å…¨", health: "éª¨éª¼ã€ç©©å®š", reverse: "æµªè²»ã€å‹•ç›ª" },
            "åœ“ç›¤5": { general: "æ†‚æ…®ã€åŒ±ä¹ã€ä¸å®‰å®š", work: "ç¶“æ¿Ÿå›°çª˜ã€ç„¦æ…®", love: "ç‰©è³ªè€ƒé©—ã€çª®å›°", health: "ç‡Ÿé¤Šä¸è‰¯", reverse: "æƒ…æ³å¥½è½‰" },
            "åœ“ç›¤6": { general: "æˆåŠŸã€æ–½èˆ‡å—ã€åˆ†äº«", work: "ç²å¾—è´ŠåŠ©ã€æ…ˆå–„", love: "æ…·æ…¨äº’æƒ ", health: "å¥åº·æ¢å¾©", reverse: "è‡ªç§ã€è² å‚µ" },
            "åœ“ç›¤7": { general: "å¤±æ•—ã€å»¶é²ã€ç­‰å¾…", work: "æŠ•è³‡æœªæœã€è€ƒé©—", love: "æƒ…æ„Ÿå†·æ·¡æœŸ", health: "æ…¢æ€§ç–²å‹", reverse: "é‡æ•´æ——é¼“" },
            "åœ“ç›¤8": { general: "è¬¹æ…ã€ç²¾ç·»ã€ç´€å¾‹", work: "è·äººç²¾ç¥ã€ç©©å®šç”¢å‡º", love: "ç´°å¿ƒå‘µè­·", health: "è¦å¾‹ä½œæ¯", reverse: "è‰ç‡ã€å·æ‡¶" },
            "åœ“ç›¤9": { general: "æ”¶ç©«ã€ç²ç›Šã€ç¨è™•", work: "è²¡å‹™è‡ªç”±ã€ç¨ç«‹ç¶“ç‡Ÿ", love: "è‡ªå¾—å…¶æ¨‚", health: "è‰¯å¥½èº«å¿ƒ", reverse: "è²¡ç”¢ç´›çˆ­" },
            "åœ“ç›¤10": { general: "è²¡å¯Œã€éºç”¢ã€å‚³æ‰¿", work: "å®¶æ—äº‹æ¥­ã€é ‚å³°", love: "å®¶æ—é€£çµã€ç©©å®šå©šå§»", health: "éºå‚³ç–¾ç—…æ³¨æ„", reverse: "éºç”¢ç´›çˆ­" }
        };

        let deck = [...thothCards];
        const table = document.getElementById('cardTable');
        const mainCanvas = document.getElementById('mainCanvas');
        const hint = document.getElementById('hint');
        const tooltip = document.getElementById('tooltip');
        const deckPanel = document.getElementById('deckPanel');
        const toggleBtn = document.getElementById('deckPanelToggle');
        
        let isSpread = false;
        let selectedCount = 0;
        let hoverTimer = null;
        let panOffsetX = 0, panOffsetY = 0, initialMidX = 0, initialMidY = 0, initialOffsetX = 0, initialOffsetY = 0;
        let isPanning = false, startX, startY;
        let touchStartTime = 0;
        let touchStartX = 0;
        let touchStartY = 0;
        let isDraggingCard = false;
        let patternStyleElement = null;

        window.addEventListener('mousedown', (e) => { if (e.button === 1) { e.preventDefault(); isPanning = true; startX = e.clientX - panOffsetX; startY = e.clientY - panOffsetY; } });
        window.addEventListener('mousemove', (e) => { if (!isPanning) return; panOffsetX = e.clientX - startX; panOffsetY = e.clientY - startY; mainCanvas.style.transform = `translate(${panOffsetX}px, ${panOffsetY}px)`; });
        window.addEventListener('mouseup', (e) => { if (e.button === 1) isPanning = false; });

        mainCanvas.addEventListener('touchstart', (e) => {
            if (e.touches.length === 2) {
                const t1 = e.touches[0], t2 = e.touches[1];
                initialMidX = (t1.clientX + t2.clientX) / 2; initialMidY = (t1.clientY + t2.clientY) / 2;
                initialOffsetX = panOffsetX; initialOffsetY = panOffsetY;
            }
        });
        mainCanvas.addEventListener('touchmove', (e) => {
            if (e.touches.length === 2) {
                e.preventDefault();
                const t1 = e.touches[0], t2 = e.touches[1];
                const midX = (t1.clientX + t2.clientX) / 2, midY = (t1.clientY + t2.clientY) / 2;
                panOffsetX = initialOffsetX + (midX - initialMidX);
                panOffsetY = initialOffsetY + (midY - initialMidY);
                mainCanvas.style.transform = `translate(${panOffsetX}px, ${panOffsetY}px)`;
            }
        });

        function createStars() {
            const container = document.getElementById('stars');
            for (let i = 0; i < 150; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                const size = Math.random() * 3;
                star.style.width = size + 'px'; star.style.height = size + 'px';
                star.style.left = Math.random() * 100 + '%'; star.style.top = Math.random() * 100 + '%';
                star.style.setProperty('--t', (2 + Math.random() * 4) + 's');
                container.appendChild(star);
            }
        }

        function getElementClass(cardName) {
            if (cardName.includes("è–æ¯")) return "cups";
            if (cardName.includes("æ¬Šæ–")) return "wands";
            if (cardName.includes("å¯¶åŠ")) return "swords";
            if (cardName.includes("åœ“ç›¤")) return "disks";
            return "major";
        }

        function showTooltip(card, x, y) {
            const cardName = card.querySelector('.card-front').textContent.trim();
            const m = cardMeanings[cardName] || { general: "æ•´ç†ä¸­...", work: "...", love: "...", health: "...", reverse: "..." };
            tooltip.innerHTML = `<strong>${cardName}</strong><h4>ä¸€èˆ¬</h4><p>${m.general}</p><h4>å·¥ä½œ</h4><p>${m.work}</p><h4>æ„Ÿæƒ…</h4><p>${m.love}</p><h4>å¥åº·</h4><p>${m.health}</p><h4>é€†ä½</h4><p>${m.reverse}</p>`;
            tooltip.style.left = (x + 15) + 'px'; tooltip.style.top = (y + 15) + 'px';
            tooltip.classList.add('visible');
        }

        function hideTooltip() {
            tooltip.classList.remove('visible');
            clearTimeout(hoverTimer);
        }

        function initCards() {
            table.innerHTML = '';
            deck.sort(() => Math.random() - 0.5);
            for (let i = 0; i < 78; i++) {
                const card = document.createElement('div');
                card.className = 'card';
                card.style.zIndex = i;
                const elementClass = getElementClass(deck[i]);
                card.innerHTML = `
                    <div class="card-order"></div>
                    <div class="card-face card-back"></div>
                    <div class="card-face card-front ${elementClass}">${deck[i]}</div>
                `;
                card.dataset.name = deck[i];
                card.dataset.flipped = "false";
                card.dataset.touchStartTime = "0";
                card.dataset.touchStartX = "0";
                card.dataset.touchStartY = "0";
                
                // é›»è…¦ç‰ˆæ»‘é¼  hover é¡¯ç¤ºç‰Œç¾©
                card.onmouseenter = (e) => {
                    if (card.dataset.flipped === "true" && !('ontouchstart' in window)) {
                        hoverTimer = setTimeout(() => showTooltip(card, e.clientX, e.clientY), 800);
                    }
                };
                card.onmouseleave = () => { hideTooltip(); };
                
                // é»æ“Šäº‹ä»¶è™•ç†ï¼ˆé›»è…¦ç‰ˆå’Œæ‰‹æ©Ÿç‰ˆï¼‰
                card.onclick = (e) => {
                    // å¦‚æœæ˜¯è§¸æ§è¨­å‚™ä¸”æ­£åœ¨æ‹–å‹•ï¼Œä¸åŸ·è¡Œé»æ“Šå‹•ä½œ
                    if (isDraggingCard && 'ontouchstart' in window) {
                        return;
                    }
                    
                    if (!isSpread) {
                        isSpread = true;
                        hint.innerText = "è«‹é»æ“ŠæŠ½ç‰Œï¼Œé»æ“Šæ¡Œé¢ä¸ŠèƒŒé¢æœä¸Šçš„ç‰Œç¿»é–‹";
                        spreadCards();
                    } else if (!card.classList.contains('selected')) {
                        pickCard(card);
                    } else if (card.dataset.flipped === "false") {
                        flipCard(card);
                    } else if (card.dataset.flipped === "true" && 'ontouchstart' in window) {
                        // æ‰‹æ©Ÿç‰ˆï¼šé»æ“Šå·²ç¿»é–‹çš„ç‰Œé¡¯ç¤ºç‰Œç¾©
                        const rect = card.getBoundingClientRect();
                        const x = rect.left + rect.width / 2;
                        const y = rect.top + rect.height / 2;
                        showTooltip(card, x, y);
                    }
                };
                
                // è§¸æ§é–‹å§‹äº‹ä»¶ï¼ˆç”¨æ–¼æª¢æ¸¬æ˜¯å¦ç‚ºæ‹–å‹•ï¼‰
                card.addEventListener('touchstart', (e) => {
                    if (e.touches.length === 1) {
                        touchStartTime = Date.now();
                        touchStartX = e.touches[0].clientX;
                        touchStartY = e.touches[0].clientY;
                        isDraggingCard = false;
                        card.dataset.touchStartTime = touchStartTime.toString();
                        card.dataset.touchStartX = touchStartX.toString();
                        card.dataset.touchStartY = touchStartY.toString();
                    }
                }, { passive: true });
                
                // è§¸æ§ç§»å‹•äº‹ä»¶ï¼ˆå¦‚æœç§»å‹•è·é›¢éå¤§ï¼Œè¦–ç‚ºæ‹–å‹•ï¼‰
                card.addEventListener('touchmove', (e) => {
                    if (e.touches.length === 1 && touchStartTime > 0) {
                        const moveX = Math.abs(e.touches[0].clientX - touchStartX);
                        const moveY = Math.abs(e.touches[0].clientY - touchStartY);
                        if (moveX > 5 || moveY > 5) {
                            isDraggingCard = true;
                        }
                    }
                }, { passive: true });
                
                // é»æ“Šå…¶ä»–åœ°æ–¹éš±è— tooltip
                card.addEventListener('touchend', (e) => {
                    if (e.touches.length === 0 && card.dataset.flipped === "true" && 'ontouchstart' in window) {
                        const touchDuration = Date.now() - touchStartTime;
                        const moveX = Math.abs((e.changedTouches[0]?.clientX || 0) - touchStartX);
                        const moveY = Math.abs((e.changedTouches[0]?.clientY || 0) - touchStartY);
                        
                        // å¦‚æœæ˜¯çŸ­æŒ‰ï¼ˆå°æ–¼ 300msï¼‰ä¸”ç§»å‹•è·é›¢å°ï¼ˆå°æ–¼ 10pxï¼‰ï¼Œè¦–ç‚ºé»æ“Š
                        if (touchDuration < 300 && moveX < 10 && moveY < 10 && !isDraggingCard) {
                            const rect = card.getBoundingClientRect();
                            const x = rect.left + rect.width / 2;
                            const y = rect.top + rect.height / 2;
                            showTooltip(card, x, y);
                        }
                    }
                }, { passive: true });
                
                table.appendChild(card);
            }
            
            // é»æ“Šå…¶ä»–å€åŸŸéš±è— tooltip
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.card') && !e.target.closest('#tooltip')) {
                    hideTooltip();
                }
            });
            
            // è§¸æ§è¨­å‚™ï¼šé»æ“Šå…¶ä»–åœ°æ–¹éš±è— tooltip
            document.addEventListener('touchend', (e) => {
                if (!e.target.closest('.card') && !e.target.closest('#tooltip')) {
                    hideTooltip();
                }
            }, { passive: true });
        }

        function spreadCards() {
            const radius = 350;
            const cards = document.querySelectorAll('.card');
            cards.forEach((c, i) => {
                const angle = ((i / 78) - 0.5) * 110;
                const x = Math.sin(angle * Math.PI / 180) * radius;
                const y = (1 - Math.cos(angle * Math.PI / 180)) * radius;
                c.style.transform = `translateX(${x}px) translateY(${y}px) rotate(${angle}deg)`;
            });
            toggleBtn.style.display = 'block';
        }

        function pickCard(card) {
            selectedCount++;
            card.classList.add('selected', 'flash');
            const tag = card.querySelector('.card-order');
            tag.innerText = selectedCount; tag.style.display = 'block';
            setTimeout(() => card.classList.remove('flash'), 300);
            
            const tx = (Math.random() - 0.5) * 320, ty = 180 + Math.random() * 60, rz = (Math.random() - 0.5) * 20;
            card.style.zIndex = 1000 + selectedCount;
            card.style.setProperty('--tx', `${tx}px`);
            card.style.setProperty('--ty', `${ty}px`);
            card.style.setProperty('--rz', `${rz}deg`);
            card.style.transform = `translate(${tx}px, ${ty}px) rotateZ(${rz}deg) rotateY(0deg)`;
            card.dataset.posX = tx; card.dataset.posY = ty; card.dataset.rotZ = rz;
            makeDraggable(card);
        }

        function flipCard(card) {
            if (card.classList.contains('flipping')) return;
            card.classList.add('flipping');
            setTimeout(() => {
                card.dataset.flipped = "true";
                const tx = card.dataset.posX, ty = card.dataset.posY;
                card.style.transform = `translate(${tx}px, ${ty}px) rotateZ(0deg) rotateY(180deg)`;
                card.dataset.rotZ = 0; 
                card.style.setProperty('--rz', `0deg`);
            }, 250);
            setTimeout(() => card.classList.remove('flipping'), 350);
        }

        function resetGame() {
            hideTooltip();
            isSpread = false; selectedCount = 0;
            panOffsetX = 0; panOffsetY = 0;
            mainCanvas.style.transform = `translate(0,0)`;
            hint.innerText = "é»æ“Šç‰Œå †å±•é–‹ (é›™æŒ‡æ‹–å‹•/ç¸®æ”¾æ¡Œé¢)";
            toggleBtn.style.display = 'none';
            deckPanel.classList.remove('open');

            const cards = document.querySelectorAll('.card');
            cards.forEach((c, i) => {
                c.classList.remove('selected');
                c.dataset.flipped = "false";
                c.querySelector('.card-order').style.display = 'none';
                const angle = (i / 78) * 360, radius = 125;
                const x = Math.cos(angle * Math.PI / 180) * radius;
                const y = Math.sin(angle * Math.PI / 180) * radius;
                c.style.transform = `translate(${x}px, ${y}px) rotate(${angle + 90}deg)`;
            });
            setTimeout(() => {
                cards.forEach(c => c.style.transform = `translate(0,0) rotate(0deg)`);
                setTimeout(initCards, 800);
            }, 600);
        }

        function makeDraggable(el) {
            let p1 = 0, p2 = 0, p3 = 0, p4 = 0;
            el.onmousedown = el.ontouchstart = (e) => {
                if (e.button === 1 || el.classList.contains('flipping')) return;
                const cx = e.touches ? e.touches[0].clientX : e.clientX;
                const cy = e.touches ? e.touches[0].clientY : e.clientY;
                el.classList.add('dragging'); p3 = cx; p4 = cy;
                document.onmouseup = document.ontouchend = () => {
                    el.classList.remove('dragging');
                    document.onmouseup = document.onmousemove = document.ontouchend = document.ontouchmove = null;
                };
                document.onmousemove = document.ontouchmove = (ev) => {
                    const ncx = ev.touches ? ev.touches[0].clientX : ev.clientX;
                    const ncy = ev.touches ? ev.touches[0].clientY : ev.clientY;
                    p1 = p3 - ncx; p2 = p4 - ncy; p3 = ncx; p4 = ncy;
                    const isF = el.dataset.flipped === "true";
                    const nx = parseFloat(el.dataset.posX) - p1, ny = parseFloat(el.dataset.posY) - p2, rz = el.dataset.rotZ;
                    el.style.transform = `translate(${nx}px, ${ny}px) rotateZ(${rz}deg) rotateY(${isF?180:0}deg)`;
                    el.dataset.posX = nx; el.dataset.posY = ny;
                    el.style.setProperty('--tx', `${nx}px`); el.style.setProperty('--ty', `${ny}px`);
                };
            };
        }

        toggleBtn.onclick = () => deckPanel.classList.toggle('open');
        function createDeckButtons() {
            deckPanel.innerHTML = '<h2 style="color:var(--gold); text-align:center;">æŒ‡å®šé¸ç‰Œ</h2>';
            const groups = [
                { title: "å¤§é˜¿å¡ç´", cards: thothCards.slice(0, 22) },
                { title: "æ¬Šæ–", cards: thothCards.filter(c => c.includes("æ¬Šæ–")) },
                { title: "è–æ¯", cards: thothCards.filter(c => c.includes("è–æ¯")) },
                { title: "å¯¶åŠ", cards: thothCards.filter(c => c.includes("å¯¶åŠ")) },
                { title: "åœ“ç›¤", cards: thothCards.filter(c => c.includes("åœ“ç›¤")) }
            ];
            groups.forEach(g => {
                const groupDiv = document.createElement('div'); groupDiv.className = 'cat-group';
                const titleBtn = document.createElement('button'); titleBtn.className = 'cat-title';
                titleBtn.innerHTML = `<span>${g.title}</span> <span>+</span>`;
                const contentDiv = document.createElement('div'); contentDiv.className = 'cat-content';
                titleBtn.onclick = () => {
                    const isActive = contentDiv.classList.contains('active');
                    document.querySelectorAll('.cat-content').forEach(c => c.classList.remove('active'));
                    if(!isActive) contentDiv.classList.add('active');
                };
                g.cards.forEach(name => {
                    const btn = document.createElement('button'); btn.className = 'card-btn'; btn.textContent = name;
                    btn.onclick = () => {
                        const target = Array.from(document.querySelectorAll('.card')).find(c => c.dataset.name === name);
                        if (target && !target.classList.contains('selected')) pickCard(target);
                    };
                    contentDiv.appendChild(btn);
                });
                groupDiv.appendChild(titleBtn); groupDiv.appendChild(contentDiv); deckPanel.appendChild(groupDiv);
            });
            
            // æ·»åŠ è‡ªè¨‚é¸é …å€åŸŸ
            const customOptions = document.createElement('div');
            customOptions.className = 'custom-options';
            customOptions.innerHTML = '<h3>è‡ªè¨‚æ¨£å¼</h3>';
            
            // èƒŒæ™¯è‰²é¸æ“‡ï¼ˆæ¼¸å±¤é…å°ï¼‰
            const bgColorGroup = document.createElement('div');
            bgColorGroup.className = 'option-group';
            bgColorGroup.innerHTML = '<label class="option-label">èƒŒæ™¯è‰²ï¼ˆæ˜Ÿç©ºæ¼¸å±¤ï¼‰</label><div class="color-options" id="bgColorOptions"></div>';
            const bgGradients = [
                { name: 'é è¨­æ™¨æ˜', value1: '#423A09', value2: '#061857' },
                { name: 'ç´«åˆ°é»‘', value1: '#342063', value2: '#090A0F' },
                { name: 'è—åˆ°é»‘', value1: '#1a1a3e', value2: '#090A0F' },
                { name: 'ç¶ åˆ°é»‘', value1: '#2d5016', value2: '#090A0F' },
                { name: 'è¤åˆ°é»‘', value1: '#4a2c2a', value2: '#090A0F' },
                { name: 'æ·±è—åˆ°ç´«', value1: '#1e3a5f', value2: '#342063' },
                { name: 'ç´«ç´…åˆ°é»‘', value1: '#5a1a4a', value2: '#090A0F' },
                { name: 'æ·±ç¶ åˆ°è—', value1: '#1e3d1e', value2: '#1a1a3e' }
            ];
            bgGradients.forEach((grad, index) => {
                const btn = document.createElement('div');
                btn.className = 'color-btn';
                // å‰µå»ºæ¼¸å±¤èƒŒæ™¯é¡¯ç¤º
                btn.style.background = `linear-gradient(to bottom, ${grad.value1}, ${grad.value2})`;
                btn.dataset.color1 = grad.value1;
                btn.dataset.color2 = grad.value2;
                if (index === 0) btn.classList.add('active');
                btn.onclick = () => {
                    document.querySelectorAll('#bgColorOptions .color-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    // æ›´æ–° body èƒŒæ™¯è‰²
                    document.body.style.background = grad.value1;
                    // æ›´æ–°æ˜Ÿç©ºèƒŒæ™¯æ¼¸å±¤
                    const starsContainer = document.getElementById('stars');
                    starsContainer.style.background = `radial-gradient(ellipse at bottom, ${grad.value1} 0%, ${grad.value2} 100%)`;
                };
                bgColorGroup.querySelector('#bgColorOptions').appendChild(btn);
            });
            
            // ç‰ŒèƒŒé¡è‰²é¸æ“‡
            const cardBackColorGroup = document.createElement('div');
            cardBackColorGroup.className = 'option-group';
            cardBackColorGroup.innerHTML = '<label class="option-label">ç‰Œçš„èƒŒé¢é¡è‰²</label><div class="color-options" id="cardBackColorOptions"></div>';
            const cardBackColors = [
                { name: 'é è¨­', value: '#4A3204' },
                { name: 'æ·±è¤', value: '#3d2813' },
                { name: 'æ·±è—', value: '#1e3a5f' },
                { name: 'æ·±ç´«', value: '#2d1b3d' },
                { name: 'å¢¨ç¶ ', value: '#1e3d1e' },
                { name: 'é»‘è‰²', value: '#1a1a1a' }
            ];
            cardBackColors.forEach(color => {
                const btn = document.createElement('div');
                btn.className = 'color-btn';
                btn.style.backgroundColor = color.value;
                btn.dataset.color = color.value;
                if (color.value === '#4A3204') btn.classList.add('active');
                btn.onclick = () => {
                    document.querySelectorAll('#cardBackColorOptions .color-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    document.querySelectorAll('.card-back').forEach(cb => {
                        cb.style.backgroundColor = color.value;
                    });
                };
                cardBackColorGroup.querySelector('#cardBackColorOptions').appendChild(btn);
            });
            
            // ç‰ŒèƒŒåœ–æ¡ˆé¸æ“‡
            const cardBackPatternGroup = document.createElement('div');
            cardBackPatternGroup.className = 'option-group';
            cardBackPatternGroup.innerHTML = '<label class="option-label">ç‰ŒèƒŒé¢çš„éš¨æ©Ÿåœ–æ¡ˆ</label><div class="pattern-options" id="cardBackPatternOptions"></div>';
            const patterns = [
                { name: 'é è¨­', value: 'ğ–¤“' },
                { name: 'æ˜Ÿ', value: 'â˜…' },
                { name: 'æœˆ', value: 'ğŸŒ™' },
                { name: 'å¤ªé™½', value: 'â˜‰' },
                { name: 'å…­èŠ’æ˜Ÿ', value: 'âœ¡' },
                { name: 'åœ“', value: 'â—' },
                { name: 'è±å½¢', value: 'â—†' },
                { name: 'ä¸‰è§’å½¢', value: 'â–²' }
            ];
            patterns.forEach(pattern => {
                const btn = document.createElement('div');
                btn.className = 'pattern-btn';
                btn.textContent = pattern.value;
                btn.dataset.pattern = pattern.value;
                if (pattern.value === 'ğ–¤“') btn.classList.add('active');
                btn.onclick = () => {
                    document.querySelectorAll('#cardBackPatternOptions .pattern-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    // æ›´æ–°æ‰€æœ‰ç‰ŒèƒŒçš„ CSS è®Šæ•¸
                    document.querySelectorAll('.card-back').forEach(cb => {
                        cb.style.setProperty('--pattern-content', `"${pattern.value}"`);
                    });
                    // å‰µå»ºæˆ–æ›´æ–°å…¨å±€æ¨£å¼å…ƒç´ 
                    if (!patternStyleElement) {
                        patternStyleElement = document.createElement('style');
                        patternStyleElement.id = 'cardBackPatternStyle';
                        document.head.appendChild(patternStyleElement);
                    }
                    patternStyleElement.textContent = `.card-back::after { content: var(--pattern-content, "${pattern.value}") !important; }`;
                };
                cardBackPatternGroup.querySelector('#cardBackPatternOptions').appendChild(btn);
            });
            
            customOptions.appendChild(bgColorGroup);
            customOptions.appendChild(cardBackColorGroup);
            customOptions.appendChild(cardBackPatternGroup);
            deckPanel.appendChild(customOptions);
        }

        createStars(); initCards(); createDeckButtons();
    </script>
</body>
</html>
