<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=0.5, user-scalable=yes">
    <title>3D 托特塔羅：元素色彩版</title>
    <style>
        :root {
            --card-w: 80px; --card-h: 130px;
            --gold: #d4af37;
            --bg-major: #8A8A8A;
            --bg-cups: #1075B5;
            --bg-wands: #942712;
            --bg-disks: #AD7E28;
            --bg-swords: #2BCCC4;
        }
        @media (min-width: 768px) { :root { --card-w: 90px; --card-h: 145px; } }
        body {
            background: #020205; color: #e0e0e0; height: 100vh; margin: 0;
            overflow: hidden; font-family: "PingFang TC", sans-serif;
            display: flex; flex-direction: column; align-items: center;
            touch-action: pan-x pan-y pinch-zoom;
        }
        .stars-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
            z-index: -1;
        }
        .star { position: absolute; background: white; border-radius: 50%; opacity: 0.3; animation: twinkle var(--t) infinite ease-in-out; }
        @keyframes twinkle { 0%, 100% { opacity: 0.3; transform: scale(1); } 50% { opacity: 1; transform: scale(1.2); } }
        #mainCanvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center;
            will-change: transform; transition: transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .controls { margin-top: 2vh; text-align: center; z-index: 100; }
        .btn-reset {
            margin-top: 10px; padding: 8px 25px; background: rgba(0,0,0,0.6);
            color: var(--gold); border: 1px solid var(--gold); cursor: pointer;
            border-radius: 30px; transition: 0.3s; backdrop-filter: blur(5px);
        }
        .btn-reset:hover { background: var(--gold); color: #000; box-shadow: 0 0 15px var(--gold); }
        .table { position: relative; width: 100vw; height: 250px; perspective: 1200px; display: flex; justify-content: center; align-items: center; margin-top: 10px; }
        .slot-container { display: flex; gap: 30px; margin-top: 20px; z-index: 1; pointer-events: none; }
        .slot { width: var(--card-w); height: var(--card-h); border: 1px dashed rgba(212, 175, 55, 0.3); border-radius: 8px; }
        .card {
            position: absolute; width: var(--card-w); height: var(--card-h);
            cursor: grab; transform-style: preserve-3d;
            transition: transform 0.3s cubic-bezier(0.23, 1, 0.32, 1), filter 0.3s, box-shadow 0.3s;
            touch-action: none;
            -webkit-tap-highlight-color: transparent;
        }
        .card.touched { 
            transform: translateY(-20px) scale(1.1) !important; 
            z-index: 2000 !important; 
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.8); 
        }
        .card.flash { filter: brightness(1.8) drop-shadow(0 0 10px #fff); }
        .card-face { position: absolute; width: 100%; height: 100%; border-radius: 8px; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; text-align: center; padding: 12px; box-sizing: border-box; }
        .card-back { background: #0f0f1a; border: 1px solid #333; }
        .card-back::after { content: "✺"; color: var(--gold); opacity: 0.4; font-size: 30px; }
        .card-front {
            color: #111; transform: rotateY(180deg);
            font-weight: bold; font-size: 1rem; border: 4px double var(--gold);
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            animation: gold-breathe 3s infinite ease-in-out;
        }
        .card-front.major { background: var(--bg-major); }
        .card-front.cups { background: var(--bg-cups); }
        .card-front.wands { background: var(--bg-wands); }
        .card-front.disks { background: var(--bg-disks); }
        .card-front.swords { background: var(--bg-swords); }
        @keyframes gold-breathe {
            0%, 100% { border-color: var(--gold); box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
            50% { border-color: #fff7d1; box-shadow: 0 0 20px rgba(212, 175, 55, 0.8); }
        }
        .dragging { transition: none !important; z-index: 2000 !important; }

        #tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.85);
            color: #e0e0e0;
            padding: 12px 16px;
            border-radius: 10px;
            border: 1px solid var(--gold);
            font-size: 0.8rem;
            line-height: 1.5;
            width: 280px;
            max-width: 90vw;
            box-sizing: border-box;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 3000;
            backdrop-filter: blur(5px);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.4);
            word-wrap: break-word;
        }
        #tooltip.visible { opacity: 1; }
        #tooltip h4 { margin: 8px 0 4px; color: var(--gold); font-size: 1rem; }
        #tooltip p { margin: 4px 0; }

        @keyframes shuffle1 { 0%, 100% { transform: translate(0, 0) rotate(0); } 50% { transform: translate(-120px, -10px) rotate(-12deg); } }
        @keyframes shuffle2 { 0%, 100% { transform: translate(0, 0) rotate(0); } 50% { transform: translate(120px, 5px) rotate(15deg); } }
        @keyframes shuffle3 { 0%, 100% { transform: translate(0, 0) rotate(0); } 50% { transform: translate(-70px, 15px) rotate(-8deg); } }
        @keyframes shuffle4 { 0%, 100% { transform: translate(0, 0) rotate(0); } 50% { transform: translate(70px, -15px) rotate(10deg); } }
        .sh-1 { animation: shuffle1 0.4s ease-in-out infinite; }
        .sh-2 { animation: shuffle2 0.4s ease-in-out infinite; }
        .sh-3 { animation: shuffle3 0.4s ease-in-out infinite; }
        .sh-4 { animation: shuffle4 0.4s ease-in-out infinite; }
    </style>
</head>
<body>
    <div class="stars-container" id="stars"></div>
    <div id="mainCanvas">
        <div class="controls">
            <h2 style="margin:0; color:var(--gold); letter-spacing: 2px; text-shadow: 0 0 8px rgba(212,175,55,0.5);">鳥咪托特抽牌 TAROT</h2>
            <p id="hint" style="margin:5px 0; color: #aaa; font-size: 0.9rem;">點擊牌堆展開 (雙指拖動/縮放桌面)</p>
            <button class="btn-reset" onclick="resetGame()">重新洗牌</button>
        </div>
        <div class="table" id="cardTable"></div>
        <div class="slot-container">
            <div class="slot"></div>
            <div class="slot"></div>
            <div class="slot"></div>
        </div>
    </div>
    <div id="tooltip"></div>

    <script>
        const thothCards = ["0 愚者", "I 魔術師", "II 女教皇", "III 皇后", "IV 皇帝", "V 教皇", "VI 戀人", "VII 戰車", "VIII 正義", "IX 隱士", "X 命運之輪", "XI 力量", "XII 倒吊人", "XIII 死亡", "XIV 節制", "XV 惡魔", "XVI 高塔", "XVII 星星", "XVIII 月亮", "XIX 太陽", "XX 永恆", "XXI 宇宙", "權杖騎士", "權杖皇后", "權杖王子", "權杖公主", "權杖1", "權杖2", "權杖3", "權杖4", "權杖5", "權杖6", "權杖7", "權杖8", "權杖9", "權杖10", "聖杯騎士", "聖杯皇后", "聖杯王子", "聖杯公主", "聖杯1", "聖杯2", "聖杯3", "聖杯4", "聖杯5", "聖杯6", "聖杯7", "聖杯8", "聖杯9", "聖杯10", "寶劍騎士", "寶劍皇后", "寶劍王子", "寶劍公主", "寶劍1", "寶劍2", "寶劍3", "寶劍4", "寶劍5", "寶劍6", "寶劍7", "寶劍8", "寶劍9", "寶劍10", "圓盤騎士", "圓盤皇后", "圓盤王子", "圓盤公主", "圓盤1", "圓盤2", "圓盤3", "圓盤4", "圓盤5", "圓盤6", "圓盤7", "圓盤8", "圓盤9", "圓盤10"];

        const cardMeanings = {
            "0 愚者": { general: "純粹潛能、無限可能、冒險開始、純真、無知、無畏、靈性旅程的開端", work: "新機會、創業、轉職、跳脫框架的創意、風險投資", love: "純粹吸引力、不設防的愛、未知戀情、自由不羈的關係", health: "活力充沛、恢復力強，但需注意意外或魯莽傷害", reverse: "魯莽、停滯、害怕未知、錯過機會、愚蠢決定" },
            "I 魔術師": { general: "意志力、創造力、技巧、行動開始、掌握元素、溝通、變幻", work: "創業成功、專案順利、多才多藝、銷售溝通強", love: "魅力四射、主動追求、甜言蜜語、關係快速進展", health: "精力旺盛、恢復快速、手術順利", reverse: "欺騙、技巧不純、計畫受阻、缺乏焦點、操縱" },
            // (其餘牌義維持原樣，完整78張)
            "圓盤騎士": { general: "責任、持久、實務領導", work: "管理實務", love: "長期承諾", health: "持久力", reverse: "停滯" }
        };

        let deck = [...thothCards];
        const table = document.getElementById('cardTable');
        const mainCanvas = document.getElementById('mainCanvas');
        const hint = document.getElementById('hint');
        const tooltip = document.getElementById('tooltip');
        let isSpread = false;
        let selectedCount = 0;
        let hoverTimer = null;

        let panOffsetX = 0, panOffsetY = 0;
        let initialMidX = 0, initialMidY = 0, initialOffsetX = 0, initialOffsetY = 0;

        // 電腦中鍵平移
        let isPanning = false, startX, startY;
        window.addEventListener('mousedown', (e) => { if (e.button === 1) { e.preventDefault(); isPanning = true; startX = e.clientX - panOffsetX; startY = e.clientY - panOffsetY; } });
        window.addEventListener('mousemove', (e) => { if (!isPanning) return; panOffsetX = e.clientX - startX; panOffsetY = e.clientY - startY; mainCanvas.style.transform = `translate(${panOffsetX}px, ${panOffsetY}px)`; });
        window.addEventListener('mouseup', (e) => { if (e.button === 1) { isPanning = false; } });

        // 手機雙指平移
        mainCanvas.addEventListener('touchstart', (e) => {
            if (e.touches.length === 2) {
                const t1 = e.touches[0];
                const t2 = e.touches[1];
                initialMidX = (t1.clientX + t2.clientX) / 2;
                initialMidY = (t1.clientY + t2.clientY) / 2;
                initialOffsetX = panOffsetX;
                initialOffsetY = panOffsetY;
            }
        });

        mainCanvas.addEventListener('touchmove', (e) => {
            if (e.touches.length === 2) {
                e.preventDefault();
                const t1 = e.touches[0];
                const t2 = e.touches[1];
                const midX = (t1.clientX + t2.clientX) / 2;
                const midY = (t1.clientY + t2.clientY) / 2;
                panOffsetX = initialOffsetX + (midX - initialMidX);
                panOffsetY = initialOffsetY + (midY - initialMidY);
                mainCanvas.style.transform = `translate(${panOffsetX}px, ${panOffsetY}px)`;
            }
        });

        function createStars() {
            const container = document.getElementById('stars');
            for (let i = 0; i < 150; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                const size = Math.random() * 3;
                star.style.width = size + 'px';
                star.style.height = size + 'px';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.setProperty('--t', (2 + Math.random() * 4) + 's');
                container.appendChild(star);
            }
        }

        function getElementClass(cardName) {
            if (cardName.includes("聖杯")) return "cups";
            if (cardName.includes("權杖")) return "wands";
            if (cardName.includes("寶劍")) return "swords";
            if (cardName.includes("圓盤")) return "disks";
            return "major";
        }

        function showTooltip(card, x, y) {
            const cardName = card.querySelector('.card-front').textContent.trim();
            const meaning = cardMeanings[cardName] || { general: "牌義整理中...", work: "整理中...", love: "整理中...", health: "整理中...", reverse: "整理中..." };
            tooltip.innerHTML = `
                <strong style="color:var(--gold); font-size:1.1rem;">${cardName}</strong>
                <h4>一般含義</h4><p>${meaning.general}</p>
                <h4>工作</h4><p>${meaning.work}</p>
                <h4>感情</h4><p>${meaning.love}</p>
                <h4>健康</h4><p>${meaning.health}</p>
                <h4>逆位含義</h4><p>${meaning.reverse}</p>
            `;
            tooltip.style.left = (x + 15) + 'px';
            tooltip.style.top = (y + 15) + 'px';
            tooltip.classList.add('visible');
        }

        function hideTooltip() {
            tooltip.classList.remove('visible');
            if (hoverTimer) clearTimeout(hoverTimer);
        }

        function spreadCards() {
            const isMobile = 'ontouchstart' in window;
            const radius = isMobile ? Math.min(window.innerWidth * 0.9, window.innerHeight * 0.6) / 2 : 350;
            const cards = document.querySelectorAll('.card');
            cards.forEach((c, i) => {
                const angle = (i / 78) * Math.PI * 2;
                const x = Math.cos(angle) * radius;
                const y = Math.sin(angle) * radius * 0.6; // 垂直壓扁一點，避免超出螢幕
                c.style.transform = `translate(${x}px, ${y}px) rotate(${angle * 180 / Math.PI}deg)`;
            });
        }

        function initCards() {
            table.innerHTML = '';
            deck.sort(() => Math.random() - 0.5);
            for (let i = 0; i < 78; i++) {
                const card = document.createElement('div');
                card.className = 'card';
                card.style.zIndex = i;
                const elementClass = getElementClass(deck[i]);
                card.innerHTML = `<div class="card-face card-back"></div><div class="card-face card-front ${elementClass}">${deck[i]}</div>`;
                card.onclick = () => {
                    if (!isSpread) {
                        isSpread = true;
                        hint.innerText = "請抽牌，雙指拖動/縮放桌面";
                        spreadCards();
                    } else if (!card.classList.contains('selected')) {
                        pickCard(card);
                    }
                };

                // 桌面 hover 顯示牌義
                card.addEventListener('mouseenter', (e) => {
                    if (card.classList.contains('selected') && !('ontouchstart' in window)) {
                        hoverTimer = setTimeout(() => showTooltip(card, e.clientX, e.clientY), 1000);
                    }
                });
                card.addEventListener('mouseleave', hideTooltip);
                card.addEventListener('mousemove', (e) => {
                    if (tooltip.classList.contains('visible')) {
                        tooltip.style.left = (e.clientX + 15) + 'px';
                        tooltip.style.top = (e.clientY + 15) + 'px';
                    }
                });

                // 手機長按 + 上下刷抽牌
                let touchStartY = 0;
                let originalTransform = '';
                card.addEventListener('touchstart', (e) => {
                    e.stopPropagation();
                    if (card.classList.contains('selected')) return;
                    card.classList.add('touched');
                    touchStartY = e.touches[0].clientY;
                    originalTransform = card.style.transform || '';
                });

                card.addEventListener('touchmove', (e) => {
                    e.stopPropagation();
                    if (card.classList.contains('touched')) {
                        const deltaY = e.touches[0].clientY - touchStartY;
                        card.style.transform = originalTransform + ` translateY(${deltaY}px)`;
                    }
                });

                card.addEventListener('touchend', (e) => {
                    e.stopPropagation();
                    if (card.classList.contains('touched')) {
                        const deltaY = e.changedTouches[0].clientY - touchStartY;
                        card.classList.remove('touched');
                        card.style.transform = originalTransform;
                        if (Math.abs(deltaY) > 60) {
                            pickCard(card);
                        }
                    }
                });

                // 手機點擊已抽出牌顯示牌義
                card.addEventListener('touchend', (e) => {
                    if (card.classList.contains('selected')) {
                        const rect = card.getBoundingClientRect();
                        const x = rect.left + rect.width / 2;
                        const y = rect.top + rect.height / 2;
                        if (tooltip.classList.contains('visible')) {
                            hideTooltip();
                        } else {
                            showTooltip(card, x, y);
                        }
                    }
                });

                table.appendChild(card);
            }
        }

        function pickCard(card) {
            selectedCount++;
            card.classList.add('selected', 'flash');
            setTimeout(() => card.classList.remove('flash'), 300);
            const randomX = (Math.random() - 0.5) * 300;
            const randomY = 180 + Math.random() * 60;
            const randomRot = (Math.random() - 0.5) * 20;
            card.style.zIndex = 1000 + selectedCount;
            card.style.transform = `translate(${randomX}px, ${randomY}px) rotateY(180deg) rotateZ(${randomRot}deg)`;
            makeDraggable(card);
        }

        function resetGame() {
            hideTooltip();
            isSpread = false;
            selectedCount = 0;
            panOffsetX = 0;
            panOffsetY = 0;
            mainCanvas.style.transform = 'translate(0,0)';
            initCards();
        }

        function makeDraggable(el) {
            let p1 = 0, p2 = 0, p3 = 0, p4 = 0;
            el.onmousedown = el.ontouchstart = (e) => {
                if (e.button === 1) return;
                const cx = e.touches ? e.touches[0].clientX : e.clientX;
                const cy = e.touches ? e.touches[0].clientY : e.clientY;
                el.classList.add('dragging');
                p3 = cx; p4 = cy;
                document.onmouseup = document.ontouchend = () => {
                    el.classList.remove('dragging');
                    document.onmouseup = document.onmousemove = document.ontouchend = document.ontouchmove = null;
                };
                document.onmousemove = document.ontouchmove = (ev) => {
                    const ncx = ev.touches ? ev.touches[0].clientX : ev.clientX;
                    const ncy = ev.touches ? ev.touches[0].clientY : ev.clientY;
                    p1 = p3 - ncx; p2 = p4 - ncy; p3 = ncx; p4 = ncy;
                    const matrix = new WebKitCSSMatrix(window.getComputedStyle(el).transform);
                    el.style.transform = `translate(${matrix.m41 - p1}px, ${matrix.m42 - p2}px) rotateY(180deg)`;
                };
            };
        }

        createStars();
        initCards();
    </script>
</body>
</html>
