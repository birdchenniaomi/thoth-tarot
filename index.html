<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=0.5, user-scalable=yes">
    <title>3D æ‰˜ç‰¹å¡”ç¾…ï¼šå…ƒç´ è‰²å½©ç‰ˆ</title>
    <style>
        :root {
            --card-w: 80px; --card-h: 130px;
            --gold: #d4af37;
            --bg-major: #8A8A8A;
            --bg-cups: #1075B5;
            --bg-wands: #942712;
            --bg-disks: #AD7E28;
            --bg-swords: #2BCCC4;
        }
        @media (min-width: 768px) { :root { --card-w: 90px; --card-h: 145px; } }
        body {
            background: #CC9016; color: #e0e0e0; height: 100vh; margin: 0;
            overflow: hidden; font-family: "PingFang TC", sans-serif;
            display: flex; flex-direction: column; align-items: center;
            touch-action: pan-x pan-y pinch-zoom;
        }
        .stars-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(ellipse at bottom, #342063 0%, #090A0F 100%);
            z-index: -1;
        }
        .star { position: absolute; background: white; border-radius: 50%; opacity: 0.3; animation: twinkle var(--t) infinite ease-in-out; }
        @keyframes twinkle { 0%, 100% { opacity: 0.3; transform: scale(1); } 50% { opacity: 1; transform: scale(1.2); } }
        #mainCanvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center;
            will-change: transform; transition: transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .controls { margin-top: 2vh; text-align: center; z-index: 100; }
        .btn-reset {
            margin-top: 10px; padding: 8px 25px; background: rgba(0,0,0,0.6);
            color: var(--gold); border: 1px solid var(--gold); cursor: pointer;
            border-radius: 30px; transition: 0.3s; backdrop-filter: blur(5px);
        }
        .btn-reset:hover { background: var(--gold); color: #000; box-shadow: 0 0 15px var(--gold); }
        .table { position: relative; width: 100vw; height: 250px; perspective: 1200px; display: flex; justify-content: center; align-items: center; margin-top: 10px; }
        .slot-container { display: flex; gap: 30px; margin-top: 20px; z-index: 1; pointer-events: none; }
        .slot { width: var(--card-w); height: var(--card-h); border: 1px dashed rgba(212, 175, 55, 0.3); border-radius: 8px; }
        .card {
            position: absolute; width: var(--card-w); height: var(--card-h);
            cursor: grab; transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.23, 1, 0.32, 1), filter 0.3s;
            touch-action: none;
            -webkit-tap-highlight-color: transparent;
        }
        .card.flash { filter: brightness(1.8) drop-shadow(0 0 10px #fff); }
        .card-face { position: absolute; width: 100%; height: 100%; border-radius: 8px; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; text-align: center; padding: 12px; box-sizing: border-box; }
        .card-back { background: #4A3204; border: 2px solid #737373; }
        .card-back::after { content: "ğ–¤“"; color: var(--gold); opacity: 0.4; font-size: 70px; }
        .card-front {
            color: #111; transform: rotateY(180deg);
            font-weight: bold; font-size: 1rem; border: 4px double var(--gold);
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            animation: gold-breathe 3s infinite ease-in-out;
        }
        .card-front.major { background: var(--bg-major); }
        .card-front.cups { background: var(--bg-cups); }
        .card-front.wands { background: var(--bg-wands); }
        .card-front.disks { background: var(--bg-disks); }
        .card-front.swords { background: var(--bg-swords); }
        @keyframes gold-breathe {
            0%, 100% { border-color: var(--gold); box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
            50% { border-color: #fff7d1; box-shadow: 0 0 20px rgba(212, 175, 55, 0.8); }
        }
        .dragging { transition: none !important; z-index: 2000 !important; }
        #tooltip {
            position: absolute; background: rgba(0, 0, 0, 0.85); color: #e0e0e0;
            padding: 12px 16px; border-radius: 10px; border: 1px solid var(--gold);
            font-size: 0.8rem; line-height: 1.5; width: 280px; max-width: 90vw;
            box-sizing: border-box; pointer-events: none; opacity: 0; transition: opacity 0.3s;
            z-index: 3000; backdrop-filter: blur(5px); box-shadow: 0 0 15px rgba(212, 175, 55, 0.4);
            word-wrap: break-word;
        }
        #tooltip.visible { opacity: 1; }
        #tooltip h4 { margin: 8px 0 4px; color: var(--gold); font-size: 1rem; }
        #tooltip p { margin: 4px 0; }

        /* å·¦å´é¸å–® */
        #deckPanelToggle {
            position: fixed; left: 10px; top: 50%; transform: translateY(-50%);
            padding: 15px 10px; background: rgba(0,0,0,0.8); color: var(--gold);
            border: 1px solid var(--gold); border-radius: 0 10px 10px 0;
            cursor: pointer; z-index: 400; writing-mode: vertical-rl; font-size: 1.2rem;
            backdrop-filter: blur(5px);
            display: none; /* åˆå§‹éš±è— */
        }
        #deckPanel {
            position: fixed; left: -300px; top: 0; width: 300px; height: 100%; background: rgba(0,0,0,0.95);
            border-right: 1px solid var(--gold); z-index: 350; transition: left 0.4s ease;
            padding: 20px 10px; box-sizing: border-box; overflow-y: auto; backdrop-filter: blur(10px);
        }
        #deckPanel.open { left: 0; }
        
        .cat-group { margin-bottom: 10px; border-bottom: 1px solid rgba(212,175,55,0.2); }
        .cat-title {
            width: 100%; padding: 12px; background: none; border: none; color: var(--gold);
            font-size: 1.1rem; font-weight: bold; text-align: left; cursor: pointer;
            display: flex; justify-content: space-between;
        }
        .cat-content { display: none; padding: 5px 0 15px 10px; flex-wrap: wrap; gap: 5px; }
        .cat-content.active { display: flex; }
        .card-btn {
            display: inline-block; width: 46%; margin: 2px; padding: 8px 5px;
            background: rgba(255,255,255,0.05); color: #e0e0e0; border: 1px solid #444;
            border-radius: 4px; cursor: pointer; text-align: center; font-size: 0.85rem;
        }
        .card-btn:hover { background: var(--gold); color: #000; border-color: var(--gold); }
    </style>
</head>
<body>
    <div class="stars-container" id="stars"></div>
    <div id="mainCanvas">
        <div class="controls">
            <h2 style="margin:0; color:var(--gold); letter-spacing: 2px; text-shadow: 0 0 8px rgba(212,175,55,0.5);">é³¥å’ªæ‰˜ç‰¹æŠ½ç‰Œ TAROT</h2>
            <p id="hint" style="margin:5px 0; color: #aaa; font-size: 0.9rem;">é»æ“Šç‰Œå †å±•é–‹ (é›™æŒ‡æ‹–å‹•/ç¸®æ”¾æ¡Œé¢)</p>
            <button class="btn-reset" onclick="resetGame()">é‡æ–°æ´—ç‰Œ</button>
        </div>
        <div class="table" id="cardTable"></div>
        <div class="slot-container">
            <div class="slot"></div>
            <div class="slot"></div>
            <div class="slot"></div>
        </div>
    </div>
    <div id="tooltip"></div>

    <div id="deckPanelToggle">é¸ç‰Œ</div>
    <div id="deckPanel"></div>

    <script>
        const thothCards = ["0 æ„šè€…", "I é­”è¡“å¸«", "II å¥³æ•™çš‡", "III çš‡å", "IV çš‡å¸", "V æ•™çš‡", "VI æˆ€äºº", "VII æˆ°è»Š", "VIII æ­£ç¾©", "IX éš±å£«", "X å‘½é‹ä¹‹è¼ª", "XI åŠ›é‡", "XII å€’åŠäºº", "XIII æ­»äº¡", "XIV ç¯€åˆ¶", "XV æƒ¡é­”", "XVI é«˜å¡”", "XVII æ˜Ÿæ˜Ÿ", "XVIII æœˆäº®", "XIX å¤ªé™½", "XX æ°¸æ†", "XXI å®‡å®™", "æ¬Šæ–é¨å£«", "æ¬Šæ–çš‡å", "æ¬Šæ–ç‹å­", "æ¬Šæ–å…¬ä¸»", "æ¬Šæ–1", "æ¬Šæ–2", "æ¬Šæ–3", "æ¬Šæ–4", "æ¬Šæ–5", "æ¬Šæ–6", "æ¬Šæ–7", "æ¬Šæ–8", "æ¬Šæ–9", "æ¬Šæ–10", "è–æ¯é¨å£«", "è–æ¯çš‡å", "è–æ¯ç‹å­", "è–æ¯å…¬ä¸»", "è–æ¯1", "è–æ¯2", "è–æ¯3", "è–æ¯4", "è–æ¯5", "è–æ¯6", "è–æ¯7", "è–æ¯8", "è–æ¯9", "è–æ¯10", "å¯¶åŠé¨å£«", "å¯¶åŠçš‡å", "å¯¶åŠç‹å­", "å¯¶åŠå…¬ä¸»", "å¯¶åŠ1", "å¯¶åŠ2", "å¯¶åŠ3", "å¯¶åŠ4", "å¯¶åŠ5", "å¯¶åŠ6", "å¯¶åŠ7", "å¯¶åŠ8", "å¯¶åŠ9", "å¯¶åŠ10", "åœ“ç›¤é¨å£«", "åœ“ç›¤çš‡å", "åœ“ç›¤ç‹å­", "åœ“ç›¤å…¬ä¸»", "åœ“ç›¤1", "åœ“ç›¤2", "åœ“ç›¤3", "åœ“ç›¤4", "åœ“ç›¤5", "åœ“ç›¤6", "åœ“ç›¤7", "åœ“ç›¤8", "åœ“ç›¤9", "åœ“ç›¤10"];

        const cardMeanings = {
            "0 æ„šè€…": { general: "ç´”ç²¹æ½›èƒ½ã€ç„¡é™å¯èƒ½ã€å†’éšªé–‹å§‹ã€ç´”çœŸã€ç„¡çŸ¥ã€ç„¡ç•ã€éˆæ€§æ—…ç¨‹çš„é–‹ç«¯", work: "æ–°æ©Ÿæœƒã€å‰µæ¥­ã€è½‰è·ã€è·³è„«æ¡†æ¶çš„å‰µæ„ã€é¢¨éšªæŠ•è³‡", love: "ç´”ç²¹å¸å¼•åŠ›ã€ä¸è¨­é˜²çš„æ„›ã€æœªçŸ¥æˆ€æƒ…ã€è‡ªç”±ä¸ç¾ˆçš„é—œä¿‚", health: "æ´»åŠ›å……æ²›ã€æ¢å¾©åŠ›å¼·ï¼Œä½†éœ€æ³¨æ„æ„å¤–æˆ–é­¯è½å‚·å®³", reverse: "é­¯è½ã€åœæ»¯ã€å®³æ€•æœªçŸ¥ã€éŒ¯éæ©Ÿæœƒã€æ„šè ¢æ±ºå®š" },
            "I é­”è¡“å¸«": { general: "æ„å¿—åŠ›ã€å‰µé€ åŠ›ã€æŠ€å·§ã€è¡Œå‹•é–‹å§‹ã€æŒæ¡å…ƒç´ ã€æºé€šã€è®Šå¹»", work: "å‰µæ¥­æˆåŠŸã€å°ˆæ¡ˆé †åˆ©ã€å¤šæ‰å¤šè—ã€éŠ·å”®æºé€šå¼·", love: "é­…åŠ›å››å°„ã€ä¸»å‹•è¿½æ±‚ã€ç”œè¨€èœœèªã€é—œä¿‚å¿«é€Ÿé€²å±•", health: "ç²¾åŠ›æ—ºç››ã€æ¢å¾©å¿«é€Ÿã€æ‰‹è¡“é †åˆ©", reverse: "æ¬ºé¨™ã€æŠ€å·§ä¸ç´”ã€è¨ˆç•«å—é˜»ã€ç¼ºä¹ç„¦é»ã€æ“ç¸±" },
            "II å¥³æ•™çš‡": { general: "ç›´è¦ºã€ç¥ç§˜ã€æ½›æ„è­˜ã€å…§åœ¨æ™ºæ…§ã€é™°æ€§åŠ›é‡ã€éš±è—çŸ¥è­˜", work: "ç ”ç©¶ã€å­¸ç¿’ã€éˆæ„Ÿã€å¹•å¾Œè¦åŠƒã€éœ€è¦è€å¿ƒç­‰å¾…", love: "ç¥ç§˜å¸å¼•åŠ›ã€éˆé­‚é€£çµã€æŸæ‹‰åœ–å¼æ„›æƒ…ã€å…§å¿ƒæƒ…æ„Ÿ", health: "å©¦ç§‘å•é¡Œã€è·çˆ¾è’™å¹³è¡¡ã€å¿ƒç†å¥åº·ã€å¤¢å¢ƒè¨Šæ¯", reverse: "ç§˜å¯†æ›å…‰ã€ç›´è¦ºå—é˜»ã€æƒ…ç·’å£“æŠ‘ã€è¡¨é¢å‡è±¡" },
            "III çš‡å": { general: "è±é¥’ã€æ¯æ€§ã€æ»‹é¤Šã€å‰µé€ åŠ›ã€è‡ªç„¶ã€ç¾éº—ã€æ„Ÿå®˜äº«å—", work: "å‰µä½œç”¢æ¥­ã€ç¾å®¹ã€ç¾é£Ÿã€ç©©å®šæˆé•·ã€åœ˜éšŠç…§é¡§", love: "æµªæ¼«ã€æ„Ÿæ€§ã€è¢«å¯µæ„›ã€ç”Ÿè‚²ã€ç©©å®šé—œä¿‚", health: "ç”Ÿè‚²åŠ›å¼·ã€èº«é«”è±æ»¿ã€æ¢å¾©è‰¯å¥½", reverse: "ä¾è³´ã€å«‰å¦’ã€æƒ…ç·’åŒ–ã€éåº¦æººæ„›ã€æµªè²»" },
            "IV çš‡å¸": { general: "çµæ§‹ã€æ¬Šå¨ã€ç©©å®šã€æ§åˆ¶ã€çˆ¶æ€§ã€ç†æ€§ã€é ˜å°åŠ›", work: "ç®¡ç†è·ã€å‰µæ¥­ã€ç©©å®šäº‹æ¥­ã€è¦å‰‡åˆ¶åº¦", love: "ç©©å®šé—œä¿‚ã€ä¿è­·æ¬²å¼·ã€å‚³çµ±å©šå§»", health: "éª¨éª¼å¼·å¥ã€é«”åŠ›å¥½ï¼Œä½†éœ€æ³¨æ„åƒµç¡¬", reverse: "å°ˆåˆ¶ã€é ‘å›ºã€ç¼ºä¹å½ˆæ€§ã€æ¬ŠåŠ›æ¿«ç”¨" },
            "V æ•™çš‡": { general: "å‚³çµ±ã€ç²¾ç¥æŒ‡å°ã€æ•™è‚²ã€çµæ§‹ã€é“å¾·ã€å®—æ•™ã€å°‹æ±‚å»ºè­°", work: "æ•™è‚²ã€é¡§å•ã€å‚³çµ±è¡Œæ¥­ã€éœ€è¦è­‰ç…§", love: "å‚³çµ±æˆ€æ„›ã€ç²¾ç¥ä¼´ä¾¶ã€é•·è¼©ä»‹ç´¹", health: "éœ€è¦å°ˆæ¥­é†«å¸«ã€å‚³çµ±ç™‚æ³•", reverse: "æ•™æ¢ã€åè¦‹ã€éŒ¯èª¤æŒ‡å°ã€éå‚³çµ±" },
            "VI æˆ€äºº": { general: "é¸æ“‡ã€é—œä¿‚ã€å’Œè«§ã€å¸å¼•åŠ›ã€æ•´åˆå°ç«‹ã€æ„›èˆ‡ç¾", work: "åˆä½œã€åˆå¤¥ã€é‡è¦é¸æ“‡ã€å¹³è¡¡å·¥ä½œç”Ÿæ´»", love: "æˆ€æ„›ã€å©šå§»ã€éˆé­‚ä¼´ä¾¶ã€é‡å¤§æ„Ÿæƒ…æŠ‰æ“‡", health: "è·çˆ¾è’™å¹³è¡¡ã€ä¼´ä¾¶æ”¯æŒå¥åº·", reverse: "ä¸å’Œã€åˆ†é›¢ã€éŒ¯èª¤é¸æ“‡ã€èª˜æƒ‘" },
            "VII æˆ°è»Š": { general: "å‹åˆ©ã€æ„å¿—åŠ›ã€å‰é€²ã€æ§åˆ¶æƒ…ç·’ã€æ—…ç¨‹ã€æ±ºå¿ƒ", work: "äº‹æ¥­çªç ´ã€å…‹æœéšœç¤™ã€å‡è·ã€å‡ºå·®", love: "å…‹æœæ„Ÿæƒ…éšœç¤™ã€ç©æ¥µè¿½æ±‚", health: "å…‹æœç–¾ç—…ã€æ¢å¾©æ§åˆ¶åŠ›", reverse: "æ–¹å‘è¿·å¤±ã€å¤±æ•—ã€è¡å‹•ã€äº‹æ•…" },
            "VIII æ­£ç¾©": { general: "å¹³è¡¡ã€å› æœã€å…¬å¹³ã€çœŸç›¸ã€æ³•å¾‹ã€èª¿æ•´", work: "åˆç´„ã€æ³•å¾‹äº‹å‹™ã€å…¬å¹³è©•ä¼°ã€è£å“¡æˆ–å‡è·", love: "é—œä¿‚å¹³è¡¡ã€ç¦»å©šæˆ–å©šå§»ã€å…¬å¹³å°å¾…", health: "å¹³è¡¡æ¢å¾©ã€å› æœç–¾ç—…", reverse: "ä¸å…¬ã€è¨´è¨Ÿã€åè¦‹ã€å¤±è¡¡" },
            "IX éš±å£«": { general: "å…§çœã€å­¤ç¨ã€æŒ‡å°ã€æ™ºæ…§ã€å°‹æ±‚ç­”æ¡ˆã€å…§åœ¨å…‰èŠ’", work: "ç ”ç©¶ã€ç¨ç«‹å·¥ä½œã€é€€ä¼‘ã€å°å¸«", love: "ç¨èº«ã€å…§å¿ƒæ¢ç´¢ã€å¹´é•·ä¼´ä¾¶", health: "ä¼‘é¤Šã€æ…¢æ€§ç—…ã€å¿ƒç†æ²»ç™‚", reverse: "å­¤ç«‹ã€æ‹’çµ•å¹«åŠ©ã€éŒ¯èª¤æŒ‡å¼•" },
            "X å‘½é‹ä¹‹è¼ª": { general: "å¾ªç’°ã€è®ŠåŒ–ã€å‘½é‹ã€è½‰æŠ˜é»ã€æ©Ÿæœƒã€è¼ªè¿´", work: "è½‰è·ã€é‹æ°£è½‰è®Šã€æ„å¤–æ©Ÿæœƒ", love: "ç·£åˆ†ã€é—œä¿‚è®ŠåŒ–ã€è¼ªè¿´æˆ€æƒ…", health: "å¾ªç’°æ€§ç–¾ç—…ã€é‹æ°£æ¢å¾©", reverse: "æƒ¡é‹ã€åœæ»¯ã€æ„å¤–é˜»ç¤™" },
            "XI åŠ›é‡": { general: "å…§åœ¨åŠ›é‡ã€å‹‡æ°£ã€è€å¿ƒã€æ§åˆ¶æ…¾æœ›ã€æº«æŸ”å¾æœï¼ˆæ‰˜ç‰¹ç¨±Lustï¼‰", work: "å…‹æœå›°é›£ã€ç†±æƒ…æŠ•å…¥ã€é ˜å°åŠ›", love: "æ¿€æƒ…ã€æ€§å¸å¼•åŠ›ã€å¾æœæ…¾æœ›", health: "å¼·å¥é«”åŠ›ã€å…‹æœç—…ç—›", reverse: "è»Ÿå¼±ã€ææ‡¼ã€æ…¾æœ›å¤±æ§" },
            "XII å€’åŠäºº": { general: "çŠ§ç‰²ã€é€†è½‰è¦–è§’ã€æ”¾ä¸‹ã€å•Ÿç¤ºã€ç­‰å¾…ã€è½‰è®Š", work: "æš«åœã€è½‰å‹æœŸã€çŠ§ç‰²çŸ­æœŸåˆ©ç›Š", love: "çŠ§ç‰²ã€å–®æˆ€ã€é€†è½‰é—œä¿‚", health: "æ‡¸è€Œæœªæ±ºçš„ç—…ã€éœ€è¦ä¼‘æ¯", reverse: "é ‘æŠ—è®ŠåŒ–ã€ç„¡è¬‚çŠ§ç‰²" },
            "XIII æ­»äº¡": { general: "è½‰è®Šã€çµæŸèˆ‡æ–°ç”Ÿã€è›»è®Šã€ä¸å¯é¿å…çš„æ”¹è®Š", work: "çµæŸèˆŠè·ã€æ–°é–‹å§‹ã€è½‰å‹", love: "é—œä¿‚çµæŸã€æ–°æˆ€æƒ…ã€åˆ†æ‰‹", health: "æ‰‹è¡“ã€é‡å¤§æ”¹è®Šã€åº·å¾©", reverse: "åœæ»¯ã€å®³æ€•æ”¹è®Šã€è…æ•—" },
            "XIV ç¯€åˆ¶": { general: "å¹³è¡¡ã€èª¿å’Œã€èåˆå°ç«‹ã€ç¯€åˆ¶ã€ç™‚ç™’ï¼ˆæ‰˜ç‰¹ç¨±Artï¼‰", work: "å”èª¿ã€åœ˜éšŠåˆä½œã€ä¸­åº¸ä¹‹é“", love: "å’Œè«§é—œä¿‚ã€èª¿é©å½¼æ­¤", health: "å¹³è¡¡æ¢å¾©ã€æ›¿ä»£ç™‚æ³•", reverse: "æ¥µç«¯ã€è¡çªã€ä¸å’Œ" },
            "XV æƒ¡é­”": { general: "æŸç¸›ã€æ…¾æœ›ã€ç‰©è³ªä¾è³´ã€é™°å½±é¢ã€èª˜æƒ‘ã€æ¬ŠåŠ›éŠæˆ²", work: "é‡‘éŒ¢ç³¾ç´›ã€æ¬ŠåŠ›é¬¥çˆ­ã€æˆç™®å·¥ä½œ", love: "è‚‰é«”é—œä¿‚ã€ä¾è³´ã€è™æˆ€", health: "æˆç™®ã€æ…¢æ€§å£“åŠ›", reverse: "è§£æ”¾ã€å…‹æœèª˜æƒ‘" },
            "XVI é«˜å¡”": { general: "çªè®Šã€ç ´å£èˆŠçµæ§‹ã€å•Ÿç¤ºã€è¦ºé†’ã€ç½é›£", work: "çªç™¼å¤±æ¥­ã€å…¬å¸é‡çµ„ã€å±æ©Ÿ", love: "åˆ†æ‰‹ã€é—œä¿‚å´©æ½°ã€çœŸç›¸æ›å…‰", health: "çªç™¼ç–¾ç—…ã€æ„å¤–", reverse: "é¿å…ç½é›£ã€ç·©æ…¢æ”¹è®Š" },
            "XVII æ˜Ÿæ˜Ÿ": { general: "å¸Œæœ›ã€éˆæ„Ÿã€å¯§éœã€ç™‚ç™’ã€å®‡å®™æŒ‡å¼•", work: "éˆæ„Ÿçˆ†ç™¼ã€æ–°æ–¹å‘ã€è—è¡“å‰µä½œ", love: "ç†æƒ³æ„›æƒ…ã€é è·é›¢ã€å¸Œæœ›é‡ç‡ƒ", health: "åº·å¾©ã€èº«å¿ƒç™‚ç™’", reverse: "å¤±æœ›ã€ç¼ºä¹ä¿¡å¿ƒ" },
            "XVIII æœˆäº®": { general: "å¹»è±¡ã€ææ‡¼ã€ç›´è¦ºã€æ½›æ„è­˜ã€æ¬ºé¨™ã€ç¥ç§˜", work: "ä¸ç¢ºå®šã€éš±è—é¢¨éšªã€å‰µæ„ç”¢æ¥­", love: "æ¬ºé¨™ã€ä¸å®‰ã€å¹»æƒ³æ„›æƒ…", health: "å¿ƒç†å•é¡Œã€å©¦ç§‘ã€å¤¢é­˜", reverse: "çœŸç›¸æµ®ç¾ã€å…‹æœææ‡¼" },
            "XIX å¤ªé™½": { general: "å–œæ‚…ã€æˆåŠŸã€æ´»åŠ›ã€æ¸…æ™°ã€å­©å­ã€å…‰æ˜", work: "æˆåŠŸã€èªå¯ã€å¿«æ¨‚å·¥ä½œ", love: "å¹¸ç¦é—œä¿‚ã€ç”Ÿå­ã€ç†±æˆ€", health: "æ´»åŠ›å……æ²›ã€å®Œå…¨åº·å¾©", reverse: "æš«æ™‚é™°éœ¾ã€å‚²æ…¢" },
            "XX æ°¸æ†": { general: "å¯©åˆ¤ã€é‡ç”Ÿã€è¦ºé†’ã€æ¥­åŠ›æ¸…ç®—ã€æ–°ç´€å…ƒï¼ˆæ‰˜ç‰¹ç¨±Aeonï¼‰", work: "é‡å¤§è½‰è®Šã€æ¥­åŠ›å›é¥‹ã€å‘¼å¬", love: "éˆé­‚é‡é€¢ã€æ¥­åŠ›é—œä¿‚", health: "é‡ç”Ÿã€é‡å¤§ç™‚ç™’", reverse: "å»¶é²ã€ç„¡æ³•æ”¾ä¸‹éå»" },
            "XXI å®‡å®™": { general: "å®Œæˆã€åœ“æ»¿ã€æ•´åˆã€å®‡å®™åˆä¸€ã€æ—…ç¨‹çµæŸ", work: "ç›®æ¨™é”æˆã€å‡è·ã€åœ“æ»¿çµæ¡ˆ", love: "éˆé­‚ä¼´ä¾¶ã€å©šå§»ã€é•·ä¹…ç©©å®š", health: "å®Œå…¨åº·å¾©ã€èº«å¿ƒåˆä¸€", reverse: "å»¶é²ã€æœªå®Œæˆã€å›ºåŸ·" },
            "æ¬Šæ–1": { general: "å‰µé€ ç«èŠ±ã€æ–°é–‹å§‹ã€æ½›èƒ½", work: "æ–°å°ˆæ¡ˆã€å‰µæ¥­éˆæ„Ÿ", love: "æ–°æˆ€æƒ…ç«èŠ±", health: "æ´»åŠ›é–‹å§‹", reverse: "å»¶é²ã€ç¼ºä¹å‹•åŠ›" },
            "æ¬Šæ–2": { general: "è¦åŠƒã€é¸æ“‡ã€æ”¯é…", work: "äº‹æ¥­è¦åŠƒã€æ±ºç­–", love: "é—œä¿‚é¸æ“‡", health: "èƒ½é‡å¹³è¡¡", reverse: "çŒ¶è±«ä¸æ±º" },
            "æ¬Šæ–3": { general: "å»ºç«‹ã€å±•æœ›ã€å•†å‹™", work: "äº‹æ¥­æ“´å¼µã€é æ™¯", love: "ç©©å®šç™¼å±•", health: "æ´»åŠ›ç©©å®š", reverse: "å»¶é²å¯¦ç¾" },
            "æ¬Šæ–4": { general: "æ…¶ç¥ã€å®Œæˆã€å’Œè«§", work: "éšæ®µå®Œæˆã€åœ˜éšŠå’Œè«§", love: "ç©©å®šå®¶å±…", health: "ä¼‘æ¯æ¢å¾©", reverse: "ä¸ç©©å®š" },
            "æ¬Šæ–5": { general: "ç«¶çˆ­ã€è¡çªã€æŒ‘æˆ°", work: "è·å ´ç«¶çˆ­ã€é¬¥çˆ­", love: "çˆ­åµ", health: "å£“åŠ›", reverse: "ç«¶çˆ­çµæŸ" },
            "æ¬Šæ–6": { general: "å‹åˆ©ã€èªå¯ã€å…¬çœ¾æˆåŠŸ", work: "å‡è·ã€æˆåŠŸ", love: "è¢«è¿½æ±‚", health: "å…‹æœéšœç¤™", reverse: "å¤±æ•—" },
            "æ¬Šæ–7": { general: "é˜²è¡›ã€å‹‡æ°£ã€å …æŒ", work: "æè¡›ç«‹å ´", love: "ä¿è­·é—œä¿‚", health: "æŠµæŠ—ç–¾ç—…", reverse: "é€€ç¸®" },
            "æ¬Šæ–8": { general: "å¿«é€Ÿè¡Œå‹•ã€è¨Šæ¯ã€æ—…è¡Œ", work: "çªç™¼é€²å±•ã€è¨Šæ¯", love: "å¿«é€Ÿç™¼å±•", health: "å¿«é€Ÿæ¢å¾©", reverse: "å»¶é²" },
            "æ¬Šæ–9": { general: "å …éŸŒã€é˜²å‚™ã€åŠ›é‡", work: "å …æŒåˆ°åº•", love: "ä¿è­·ç•Œç·š", health: "å¼·éŸŒé«”è³ª", reverse: "ç–²æ†Š" },
            "æ¬Šæ–10": { general: "è² æ“”ã€éåº¦åŠªåŠ›ã€å£“åŠ›", work: "å·¥ä½œéè¼‰", love: "å£“åŠ›é—œä¿‚", health: "ç²¾ç–²åŠ›ç›¡", reverse: "é‡‹æ”¾è² æ“”" },
            "æ¬Šæ–å…¬ä¸»": { general: "ç†±æƒ…ã€å‰µæ„ã€è¨Šæ¯ä½¿è€…", work: "æ–°é»å­ã€å¹´è¼•åŒäº‹", love: "ç†±æƒ…è¿½æ±‚è€…", health: "æ´»åŠ›å¹´è¼•", reverse: "ä¸æˆç†Ÿ" },
            "æ¬Šæ–ç‹å­": { general: "å†’éšªã€ç†±æƒ…ã€è¡å‹•", work: "ç©æ¥µè¡Œå‹•è€…", love: "ç†±æˆ€è¿½æ±‚", health: "é‹å‹•å‹", reverse: "è¡å‹•é­¯è²Œ" },
            "æ¬Šæ–çš‡å": { general: "è‡ªä¿¡ã€ç†±æƒ…ã€ç¨ç«‹å¥³æ€§", work: "é ˜å°å¥³æ€§", love: "æ€§æ„Ÿè‡ªä¿¡ä¼´ä¾¶", health: "æ´»åŠ›å……æ²›", reverse: "å«‰å¦’" },
            "æ¬Šæ–é¨å£«": { general: "è¡Œå‹•ã€å†’éšªã€ç†±æƒ…é ˜å°", work: "å‰µæ¥­å®¶ã€é ˜å°è€…", love: "æ¿€æƒ…ä¼´ä¾¶", health: "å¼·å¥", reverse: "æš´èº" },
            "è–æ¯1": { general: "æƒ…æ„Ÿé–‹å§‹ã€è±ç››ã€å–œæ‚…", work: "å‰µä½œæ»¿è¶³", love: "æ–°æˆ€æƒ…", health: "æƒ…æ„Ÿç™‚ç™’", reverse: "æƒ…æ„Ÿé˜»å¡" },
            "è–æ¯2": { general: "æ„›ã€å¤¥ä¼´ã€å’Œè«§", work: "åˆä½œ", love: "æˆ€æ„›ã€å©šå§»", health: "å¹³è¡¡", reverse: "ä¸å’Œ" },
            "è–æ¯3": { general: "æ…¶ç¥ã€å‹èª¼ã€è±ç››", work: "åœ˜éšŠæ…¶åŠŸ", love: "èšæœƒç´„æœƒ", health: "å¿«æ¨‚", reverse: "éåº¦äº«æ¨‚" },
            "è–æ¯4": { general: "å€¦æ€ ã€é‡æ–°è©•ä¼°ã€æ‹’çµ•", work: "å·¥ä½œå­å€¦", love: "æ„Ÿæƒ…å†·æ·¡", health: "æƒ…ç·’ä½è½", reverse: "æ–°æ©Ÿæœƒ" },
            "è–æ¯5": { general: "å¤±è½ã€æ‚²å‚·ã€éºæ†¾", work: "å¤±æ•—æ„Ÿ", love: "åˆ†æ‰‹", health: "æ†‚é¬±", reverse: "å¸Œæœ›æ¢å¾©" },
            "è–æ¯6": { general: "å›æ†¶ã€ç«¥å¹´ã€æ‡·èˆŠ", work: "èˆŠåŒäº‹", love: "èˆŠæƒ…äºº", health: "ç«¥å¹´å½±éŸ¿", reverse: "å¡åœ¨éå»" },
            "è–æ¯7": { general: "å¹»æƒ³ã€é¸æ“‡ã€èª˜æƒ‘", work: "ä¸åˆ‡å¯¦éš›è¨ˆåŠƒ", love: "å¹»æƒ³æ„›æƒ…", health: "æˆç™®", reverse: "æ¸…é†’é¸æ“‡" },
            "è–æ¯8": { general: "é›¢é–‹ã€å°‹æ±‚æ·±å±¤ã€æ”¾æ£„", work: "é›¢è·å°‹æ‰¾æ„ç¾©", love: "é›¢é–‹é—œä¿‚", health: "éˆæ€§ç™‚ç™’", reverse: "ç„¡æ³•é›¢é–‹" },
            "è–æ¯9": { general: "æ»¿è¶³ã€é¡˜æœ›å¯¦ç¾ã€äº«æ¨‚", work: "æˆåŠŸæ»¿è¶³", love: "å¹¸ç¦", health: "èº«é«”èˆ’é©", reverse: "éåº¦" },
            "è–æ¯10": { general: "å®¶åº­å¹¸ç¦ã€åœ“æ»¿ã€æƒ…æ„Ÿè±ç››", work: "å®¶åº­äº‹æ¥­", love: "å©šå§»å®¶åº­", health: "æƒ…æ„Ÿæ”¯æŒ", reverse: "å®¶åº­ä¸å’Œ" },
            "è–æ¯å…¬ä¸»": { general: "å¤¢å¹»ã€æ•æ„Ÿã€ç›´è¦ºå¥³æ€§", work: "è—è¡“å®¶", love: "æµªæ¼«å¥³å­©", health: "æ•æ„Ÿé«”è³ª", reverse: "æƒ…ç·’åŒ–" },
            "è–æ¯ç‹å­": { general: "æµªæ¼«ã€è—è¡“ã€æƒ…æ„Ÿè¿½æ±‚", work: "å‰µæ„å·¥ä½œè€…", love: "æµªæ¼«è¿½æ±‚è€…", health: "æƒ…æ„Ÿç™‚ç™’è€…", reverse: "ä¸å¯¦éš›" },
            "è–æ¯çš‡å": { general: "æ»‹é¤Šã€ç›´è¦ºã€æ¯æ€§å¥³æ€§", work: "ç™‚ç™’å¸«", love: "æº«æŸ”ä¼´ä¾¶", health: "å©¦å¥³å¥åº·", reverse: "æƒ…ç·’æ·¹æ²’" },
            "è–æ¯é¨å£«": { general: "æµªæ¼«é¨å£«ã€é‚€è«‹ã€æƒ…æ„Ÿè¡Œå‹•", work: "è—è¡“è¿½æ±‚", love: "å¤¢ä¸­æƒ…äºº", health: "æƒ…æ„Ÿå¹³è¡¡", reverse: "ä¸èª å¯¦" },
            "å¯¶åŠ1": { general: "æ¸…æ™°æ€ç¶­ã€çœŸç›¸ã€æ™ºåŠ›çªç ´", work: "æ–°æƒ³æ³•ã€æ±ºç­–", love: "æ¸…æ™°æºé€š", health: "é ­è…¦æ¸…æ™°", reverse: "æ··äº‚" },
            "å¯¶åŠ2": { general: "å¹³è¡¡æŠ‰æ“‡ã€åƒµå±€ã€å’Œå¹³", work: "å›°é›£æ±ºå®š", love: "å†·æˆ°", health: "å£“åŠ›å¹³è¡¡", reverse: "é‡‹æ”¾ç·Šå¼µ" },
            "å¯¶åŠ3": { general: "å¿ƒç¢ã€ç—›è‹¦ã€åˆ†é›¢", work: "å¤±æœ›", love: "å¤±æˆ€", health: "å¿ƒç—›", reverse: "ç™‚ç™’" },
            "å¯¶åŠ4": { general: "ä¼‘æ¯ã€æ¢å¾©ã€å†¥æƒ³", work: "ä¼‘å‡", love: "æš«åœé—œä¿‚", health: "ä½é™¢ä¼‘é¤Š", reverse: "è¡Œå‹•æ¢å¾©" },
            "å¯¶åŠ5": { general: "è¡çªã€å¤±æ•—ã€æ¬ºé¨™", work: "è·å ´é¬¥çˆ­", love: "çˆ­åŸ·", health: "å£“åŠ›æˆ°é¬¥", reverse: "æ¥å—å¤±æ•—" },
            "å¯¶åŠ6": { general: "éæ¸¡ã€æ—…è¡Œã€ç™‚ç™’ä¹‹æ—…", work: "è½‰è·", love: "æ¬å®¶æˆ–æ—…è¡Œ", health: "åº·å¾©ä¹‹æ—…", reverse: "å¡ä½" },
            "å¯¶åŠ7": { general: "ç­–ç•¥ã€å·ç«Šã€æ¬ºé¨™", work: "ä¸èª å¯¦ç«¶çˆ­", love: "èƒŒå›", health: "éš±ç–¾", reverse: "æ›å…‰" },
            "å¯¶åŠ8": { general: "æŸç¸›ã€å—å›°ã€è‡ªæˆ‘é™åˆ¶", work: "å£“åŠ›å—å›°", love: "å—å®³è€…å¿ƒæ…‹", health: "å¿ƒç†æŸç¸›", reverse: "è§£æ”¾" },
            "å¯¶åŠ9": { general: "ç„¦æ…®ã€ææ‡¼ã€å™©å¤¢", work: "å£“åŠ›å´©æ½°", love: "çµ•æœ›", health: "å¤±çœ æ†‚é¬±", reverse: "å¸Œæœ›" },
            "å¯¶åŠ10": { general: "çµæŸã€èƒŒå›ã€å´©æ½°", work: "å¤±æ¥­", love: "å¾¹åº•åˆ†æ‰‹", health: "é‡å¤§å±æ©Ÿ", reverse: "æ–°ç”Ÿ" },
            "å¯¶åŠå…¬ä¸»": { general: "æ•éŠ³ã€ç›´è¦ºã€ç¨ç«‹å¥³æ€§", work: "åˆ†æå¸«", love: "ç†æ€§å¥³å­©", health: "æ•éŠ³æ„ŸçŸ¥", reverse: "å†·é…·" },
            "å¯¶åŠç‹å­": { general: "æ™ºåŠ›ã€æºé€šã€å¹´è¼•æ€æƒ³å®¶", work: "é¡§å•", love: "ç†æ€§è¿½æ±‚", health: "é ­è…¦æ´»èº", reverse: "çˆ­è¾¯" },
            "å¯¶åŠçš‡å": { general: "ç¨ç«‹ã€æ¸…æ™°ã€æ™ºæ…§å¥³æ€§", work: "å¥³å¼·äºº", love: "ç¨ç«‹ä¼´ä¾¶", health: "ç†æ€§å¥åº·", reverse: "è‹¦æ¯’" },
            "å¯¶åŠé¨å£«": { general: "å¿«é€Ÿæ€ç¶­ã€è¡Œå‹•ã€æ™ºåŠ›è¿½æ±‚", work: "å¿«é€Ÿæ±ºç­–", love: "ç†æ€§ç†±æƒ…", health: "ç¥ç¶“ç³»çµ±", reverse: "è¡å‹•" },
            "åœ“ç›¤1": { general: "ç‰©è³ªæ©Ÿæœƒã€è±ç››é–‹å§‹ã€å¥åº·", work: "æ–°è²¡æº", love: "ç©©å®šå¸å¼•åŠ›", health: "èº«é«”å¥åº·", reverse: "éŒ¯å¤±æ©Ÿæœƒ" },
            "åœ“ç›¤2": { general: "å¹³è¡¡è®ŠåŒ–ã€é©æ‡‰ã€å¤šä»»å‹™", work: "è²¡å‹™å¹³è¡¡", love: "é—œä¿‚èµ·ä¼", health: "æŸ”è»Ÿæ€§", reverse: "å¤±è¡¡" },
            "åœ“ç›¤3": { general: "åœ˜éšŠåˆä½œã€æŠ€èƒ½ã€å»ºé€ ", work: "åˆä½œå°ˆæ¡ˆ", love: "å…±åŒåŠªåŠ›", health: "é•·æœŸå¥åº·", reverse: "å»¶é²" },
            "åœ“ç›¤4": { general: "ç©©å®šã€å®‰å…¨ã€æ“æœ‰ã€æ§åˆ¶", work: "è²¡å‹™ç©©å®š", love: "å®‰å…¨æ„Ÿ", health: "ç©©å®šé«”è³ª", reverse: "è²ªå©ª" },
            "åœ“ç›¤5": { general: "è²§çª®ã€å­¤ç«‹ã€æ“”æ†‚", work: "å¤±æ¥­", love: "å­¤ç¨", health: "è²§ç—…", reverse: "æ¢å¾©" },
            "åœ“ç›¤6": { general: "æ…·æ…¨ã€å¹³è¡¡çµ¦äºˆã€æˆåŠŸ", work: "çå‹µã€å¹«åŠ©", love: "å¹³è¡¡é—œä¿‚", health: "è³‡æºæ”¯æŒ", reverse: "ä¸å…¬" },
            "åœ“ç›¤7": { general: "ç­‰å¾…ã€è©•ä¼°ã€è€å¿ƒæŠ•è³‡", work: "é•·æœŸæŠ•è³‡", love: "è€å¿ƒç­‰å¾…", health: "ç·©æ…¢æ¢å¾©", reverse: "ç„¡æ”¶ç©«" },
            "åœ“ç›¤8": { general: "æŠ€è—ã€å‹¤å¥®ã€å­¸ç¿’", work: "å­¸å¾’ã€ç²¾é€²æŠ€èƒ½", love: "ç©©å®šåŠªåŠ›", health: "è¦å¾‹ç”Ÿæ´»", reverse: "å·å·¥æ¸›æ–™" },
            "åœ“ç›¤9": { general: "è±æ”¶ã€ç¨äº«ã€å¥¢ä¾ˆ", work: "è²¡å¯Œç´¯ç©", love: "ç¨ç«‹æ»¿è¶³", health: "èº«é«”èˆ’é©", reverse: "éåº¦" },
            "åœ“ç›¤10": { general: "å®¶æ—è²¡å¯Œã€éºç”¢ã€ç©©å®š", work: "å®¶æ—ä¼æ¥­", love: "å®¶æ—å©šå§»", health: "ä¸–ä»£å¥åº·", reverse: "å®¶æ—ç³¾ç´›" },
            "åœ“ç›¤å…¬ä¸»": { general: "å¯¦è¸ã€å­•è‚²ã€æ„Ÿå®˜å¥³æ€§", work: "å¯¦å‹™åŸ·è¡Œ", love: "æ„Ÿå®˜ä¼´ä¾¶", health: "å­•è‚²åŠ›", reverse: "æ‡¶æ•£" },
            "åœ“ç›¤ç‹å­": { general: "å¯é ã€å‹¤å¥®ã€ç‰©è³ªè¿½æ±‚", work: "ç©©å¥å·¥ä½œè€…", love: "å¯é ä¼´ä¾¶", health: "å¼·å¥é«”é­„", reverse: "å›ºåŸ·" },
            "åœ“ç›¤çš‡å": { general: "æ»‹é¤Šã€è±é¥’ã€æ¯æ€§å¤§åœ°", work: "ç©©å®šå¥³æ€§", love: "æº«æš–ä¼´ä¾¶", health: "è±æ»¿å¥åº·", reverse: "ä¾è³´" },
            "åœ“ç›¤é¨å£«": { general: "è²¬ä»»ã€æŒä¹…ã€å¯¦å‹™é ˜å°", work: "ç®¡ç†å¯¦å‹™", love: "é•·æœŸæ‰¿è«¾", health: "æŒä¹…åŠ›", reverse: "åœæ»¯" }
        };

        let deck = [...thothCards];
        const table = document.getElementById('cardTable');
        const mainCanvas = document.getElementById('mainCanvas');
        const hint = document.getElementById('hint');
        const tooltip = document.getElementById('tooltip');
        const deckPanel = document.getElementById('deckPanel');
        const toggleBtn = document.getElementById('deckPanelToggle');
        
        let isSpread = false;
        let selectedCount = 0;
        let hoverTimer = null;

        let panOffsetX = 0, panOffsetY = 0;
        let initialMidX = 0, initialMidY = 0, initialOffsetX = 0, initialOffsetY = 0;

        let isPanning = false, startX, startY;
        window.addEventListener('mousedown', (e) => { if (e.button === 1) { e.preventDefault(); isPanning = true; startX = e.clientX - panOffsetX; startY = e.clientY - panOffsetY; } });
        window.addEventListener('mousemove', (e) => { if (!isPanning) return; panOffsetX = e.clientX - startX; panOffsetY = e.clientY - startY; mainCanvas.style.transform = `translate(${panOffsetX}px, ${panOffsetY}px)`; });
        window.addEventListener('mouseup', (e) => { if (e.button === 1) { isPanning = false; } });

        mainCanvas.addEventListener('touchstart', (e) => {
            if (e.touches.length === 2) {
                const t1 = e.touches[0]; const t2 = e.touches[1];
                initialMidX = (t1.clientX + t2.clientX) / 2; initialMidY = (t1.clientY + t2.clientY) / 2;
                initialOffsetX = panOffsetX; initialOffsetY = panOffsetY;
            }
        });

        mainCanvas.addEventListener('touchmove', (e) => {
            if (e.touches.length === 2) {
                e.preventDefault();
                const t1 = e.touches[0]; const t2 = e.touches[1];
                const midX = (t1.clientX + t2.clientX) / 2; const midY = (t1.clientY + t2.clientY) / 2;
                panOffsetX = initialOffsetX + (midX - initialMidX); panOffsetY = initialOffsetY + (midY - initialMidY);
                mainCanvas.style.transform = `translate(${panOffsetX}px, ${panOffsetY}px)`;
            }
        });

        function createStars() {
            const container = document.getElementById('stars');
            for (let i = 0; i < 150; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                const size = Math.random() * 3;
                star.style.width = size + 'px'; star.style.height = size + 'px';
                star.style.left = Math.random() * 100 + '%'; star.style.top = Math.random() * 100 + '%';
                star.style.setProperty('--t', (2 + Math.random() * 4) + 's');
                container.appendChild(star);
            }
        }

        function getElementClass(cardName) {
            if (cardName.includes("è–æ¯")) return "cups";
            if (cardName.includes("æ¬Šæ–")) return "wands";
            if (cardName.includes("å¯¶åŠ")) return "swords";
            if (cardName.includes("åœ“ç›¤")) return "disks";
            return "major";
        }

        function showTooltip(card, x, y) {
            const cardName = card.querySelector('.card-front').textContent.trim();
            const meaning = cardMeanings[cardName] || { general: "æ•´ç†ä¸­...", work: "æ•´ç†ä¸­...", love: "æ•´ç†ä¸­...", health: "æ•´ç†ä¸­...", reverse: "æ•´ç†ä¸­..." };
            tooltip.innerHTML = `
                <strong style="color:var(--gold); font-size:1.1rem;">${cardName}</strong>
                <h4>ä¸€èˆ¬å«ç¾©</h4><p>${meaning.general}</p>
                <h4>å·¥ä½œ</h4><p>${meaning.work}</p>
                <h4>æ„Ÿæƒ…</h4><p>${meaning.love}</p>
                <h4>å¥åº·</h4><p>${meaning.health}</p>
                <h4>é€†ä½å«ç¾©</h4><p>${meaning.reverse}</p>
            `;
            tooltip.style.left = (x + 15) + 'px'; tooltip.style.top = (y + 15) + 'px';
            tooltip.classList.add('visible');
        }

        function hideTooltip() {
            tooltip.classList.remove('visible');
            if (hoverTimer) clearTimeout(hoverTimer);
        }

        function spreadCards() {
            const radius = 350;
            const cards = document.querySelectorAll('.card');
            cards.forEach((c, i) => {
                const angle = ((i / 78) - 0.5) * 110;
                const x = Math.sin(angle * Math.PI / 180) * radius;
                const y = (1 - Math.cos(angle * Math.PI / 180)) * radius;
                c.style.transform = `translateX(${x}px) translateY(${y}px) rotate(${angle}deg)`;
            });
            // æ”¤é–‹å¾Œæ‰é¡¯ç¤ºã€Œé¸ç‰Œã€æŒ‰éˆ•
            toggleBtn.style.display = 'block';
        }

        function initCards() {
            table.innerHTML = '';
            deck.sort(() => Math.random() - 0.5);
            for (let i = 0; i < 78; i++) {
                const card = document.createElement('div');
                card.className = 'card';
                card.style.zIndex = i;
                const elementClass = getElementClass(deck[i]);
                card.innerHTML = `<div class="card-face card-back"></div><div class="card-face card-front ${elementClass}">${deck[i]}</div>`;
                card.dataset.name = deck[i];
                card.onclick = () => {
                    if (!isSpread) {
                        isSpread = true;
                        hint.innerText = "è«‹æŠ½ç‰Œï¼Œé›™æŒ‡æ‹–å‹•/ç¸®æ”¾æ¡Œé¢";
                        spreadCards();
                    } else if (!card.classList.contains('selected')) {
                        pickCard(card);
                    }
                };
                card.addEventListener('mouseenter', (e) => {
                    if (card.classList.contains('selected') && !('ontouchstart' in window)) {
                        hoverTimer = setTimeout(() => showTooltip(card, e.clientX, e.clientY), 1000);
                    }
                });
                card.addEventListener('mouseleave', hideTooltip);
                card.addEventListener('mousemove', (e) => {
                    if (tooltip.classList.contains('visible')) {
                        tooltip.style.left = (e.clientX + 15) + 'px'; tooltip.style.top = (e.clientY + 15) + 'px';
                    }
                });
                card.addEventListener('touchend', (e) => {
                    if (card.classList.contains('selected')) {
                        e.preventDefault();
                        const touch = e.changedTouches[0];
                        if (tooltip.classList.contains('visible')) { hideTooltip(); } 
                        else { showTooltip(card, touch.clientX, touch.clientY); }
                    }
                });
                table.appendChild(card);
            }
        }

        function pickCard(card) {
            selectedCount++;
            card.classList.add('selected', 'flash');
            setTimeout(() => card.classList.remove('flash'), 300);
            const randomX = (Math.random() - 0.5) * 300;
            const randomY = 180 + Math.random() * 60;
            const randomRot = (Math.random() - 0.5) * 20;
            card.style.zIndex = 1000 + selectedCount;
            card.style.transform = `translate(${randomX}px, ${randomY}px) rotateY(180deg) rotateZ(${randomRot}deg)`;
            makeDraggable(card);
        }

        function resetGame() {
            hideTooltip();
            isSpread = false;
            selectedCount = 0;
            panOffsetX = 0; panOffsetY = 0;
            mainCanvas.style.transform = `translate(0,0)`;
            hint.innerText = "é»æ“Šç‰Œå †å±•é–‹ (é›™æŒ‡æ‹–å‹•/ç¸®æ”¾æ¡Œé¢)";
            
            // é‡ç½®æ™‚éš±è—é¸ç‰ŒåŠŸèƒ½
            toggleBtn.style.display = 'none';
            deckPanel.classList.remove('open');

            const cards = document.querySelectorAll('.card');
            cards.forEach((c, i) => {
                c.classList.remove('selected');
                const angle = (i / 78) * 360;
                const radius = 125;
                const x = Math.cos(angle * Math.PI / 180) * radius;
                const y = Math.sin(angle * Math.PI / 180) * radius;
                c.style.zIndex = i;
                c.style.transform = `translate(${x}px, ${y}px) rotate(${angle + 90}deg)`;
            });

            setTimeout(() => {
                cards.forEach((c) => { c.style.transform = `translate(0, 0) rotate(0deg)`; });
                setTimeout(() => { initCards(); }, 800);
            }, 600);
        }

        function makeDraggable(el) {
            let p1 = 0, p2 = 0, p3 = 0, p4 = 0;
            el.onmousedown = el.ontouchstart = (e) => {
                if (e.button === 1) return;
                const cx = e.touches ? e.touches[0].clientX : e.clientX;
                const cy = e.touches ? e.touches[0].clientY : e.clientY;
                el.classList.add('dragging');
                p3 = cx; p4 = cy;
                document.onmouseup = document.ontouchend = () => {
                    el.classList.remove('dragging');
                    document.onmouseup = document.onmousemove = document.ontouchend = document.ontouchmove = null;
                };
                document.onmousemove = document.ontouchmove = (ev) => {
                    const ncx = ev.touches ? ev.touches[0].clientX : ev.clientX;
                    const ncy = ev.touches ? ev.touches[0].clientY : ev.clientY;
                    p1 = p3 - ncx; p2 = p4 - ncy; p3 = ncx; p4 = ncy;
                    const matrix = new WebKitCSSMatrix(window.getComputedStyle(el).transform);
                    el.style.transform = `translate(${matrix.m41 - p1}px, ${matrix.m42 - p2}px) rotateY(180deg)`;
                };
            };
        }

        // --- é¸å–®åˆ†é¡é‚è¼¯ ---
        toggleBtn.onclick = () => { deckPanel.classList.toggle('open'); };

        function createDeckButtons() {
            deckPanel.innerHTML = '<h2 style="color:var(--gold); text-align:center;">é¸ç‰Œå–®å–®</h2>';
            const groups = [
                { title: "å¤§é˜¿å¡ç´", cards: thothCards.slice(0, 22) },
                { title: "æ¬Šæ–", cards: thothCards.filter(c => c.includes("æ¬Šæ–")) },
                { title: "è–æ¯", cards: thothCards.filter(c => c.includes("è–æ¯")) },
                { title: "å¯¶åŠ", cards: thothCards.filter(c => c.includes("å¯¶åŠ")) },
                { title: "åœ“ç›¤", cards: thothCards.filter(c => c.includes("åœ“ç›¤")) }
            ];

            groups.forEach(group => {
                const groupDiv = document.createElement('div');
                groupDiv.className = 'cat-group';
                const titleBtn = document.createElement('button');
                titleBtn.className = 'cat-title';
                titleBtn.innerHTML = `<span>${group.title}</span> <span>+</span>`;
                const contentDiv = document.createElement('div');
                contentDiv.className = 'cat-content';

                titleBtn.onclick = () => {
                    const isActive = contentDiv.classList.contains('active');
                    document.querySelectorAll('.cat-content').forEach(c => c.classList.remove('active'));
                    document.querySelectorAll('.cat-title span:last-child').forEach(s => s.textContent = '+');
                    if(!isActive) {
                        contentDiv.classList.add('active');
                        titleBtn.querySelector('span:last-child').textContent = '-';
                    }
                };

                group.cards.forEach(name => {
                    const btn = document.createElement('button');
                    btn.className = 'card-btn';
                    btn.textContent = name;
                    btn.onclick = () => {
                        const allCards = document.querySelectorAll('.card');
                        const targetCard = Array.from(allCards).find(c => c.dataset.name === name);
                        if (targetCard && !targetCard.classList.contains('selected')) {
                            pickCard(targetCard);
                        }
                        // ç§»é™¤è‡ªå‹•é—œé–‰ï¼šä¸åœ¨æ­¤è™•å‘¼å« deckPanel.classList.remove('open')
                    };
                    contentDiv.appendChild(btn);
                });
                groupDiv.appendChild(titleBtn); groupDiv.appendChild(contentDiv);
                deckPanel.appendChild(groupDiv);
            });
        }

        createStars();
        initCards();
        createDeckButtons();
    </script>
</body>
</html>
