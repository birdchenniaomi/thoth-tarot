<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=0.5, user-scalable=yes">
    <title>3D æ‰˜ç‰¹å¡”ç¾…ï¼šå…ƒç´ è‰²å½©ç‰ˆ</title>
    <style>
        :root {
            --card-w: 80px; --card-h: 130px;
            --gold: #d4af37;
            --bg-major: #8A8A8A;
            --bg-cups: #1075B5;
            --bg-wands: #942712;
            --bg-disks: #AD7E28;
            --bg-swords: #2BCCC4;
        }
        @media (min-width: 768px) { :root { --card-w: 90px; --card-h: 145px; } }
        body {
            background: #CC9016; color: #e0e0e0; height: 100vh; margin: 0;
            overflow: hidden; font-family: "PingFang TC", sans-serif;
            display: flex; flex-direction: column; align-items: center;
            touch-action: pan-x pan-y pinch-zoom;
        }
        .stars-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(ellipse at bottom, #342063 0%, #090A0F 100%);
            z-index: -1;
        }
        .star { position: absolute; background: white; border-radius: 50%; opacity: 0.3; animation: twinkle var(--t) infinite ease-in-out; }
        @keyframes twinkle { 0%, 100% { opacity: 0.3; transform: scale(1); } 50% { opacity: 1; transform: scale(1.2); } }
        #mainCanvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center;
            will-change: transform; transition: transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .controls { margin-top: 2vh; text-align: center; z-index: 100; }
        .btn-reset {
            margin-top: 10px; padding: 8px 25px; background: rgba(0,0,0,0.6);
            color: var(--gold); border: 1px solid var(--gold); cursor: pointer;
            border-radius: 30px; transition: 0.3s; backdrop-filter: blur(5px);
        }
        .btn-reset:hover { background: var(--gold); color: #000; box-shadow: 0 0 15px var(--gold); }
        .table { position: relative; width: 100vw; height: 250px; perspective: 1200px; display: flex; justify-content: center; align-items: center; margin-top: 10px; }
        .slot-container { display: flex; gap: 30px; margin-top: 20px; z-index: 1; pointer-events: none; }
        .slot { width: var(--card-w); height: var(--card-h); border: 1px dashed rgba(212, 175, 55, 0.3); border-radius: 8px; }
        .card {
            position: absolute; width: var(--card-w); height: var(--card-h);
            cursor: grab; transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.23, 1, 0.32, 1), filter 0.3s;
            touch-action: none;
            -webkit-tap-highlight-color: transparent;
        }
        .card.flash { filter: brightness(1.8) drop-shadow(0 0 10px #fff); }
        .card-face { position: absolute; width: 100%; height: 100%; border-radius: 8px; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; text-align: center; padding: 12px; box-sizing: border-box; }
        .card-back { background: #4A3204; border: 2px solid #737373; }
        .card-back::after { content: "ğ–¤“"; color: var(--gold); opacity: 0.4; font-size: 70px; }
        .card-front {
            color: #111; transform: rotateY(180deg);
            font-weight: bold; font-size: 1rem; border: 4px double var(--gold);
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            animation: gold-breathe 3s infinite ease-in-out;
        }
        .card-front.major { background: var(--bg-major); }
        .card-front.cups { background: var(--bg-cups); }
        .card-front.wands { background: var(--bg-wands); }
        .card-front.disks { background: var(--bg-disks); }
        .card-front.swords { background: var(--bg-swords); }
        @keyframes gold-breathe {
            0%, 100% { border-color: var(--gold); box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
            50% { border-color: #fff7d1; box-shadow: 0 0 20px rgba(212, 175, 55, 0.8); }
        }
        .dragging { transition: none !important; z-index: 2000 !important; }
        #tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.85);
            color: #e0e0e0;
            padding: 12px 16px;
            border-radius: 10px;
            border: 1px solid var(--gold);
            font-size: 0.8rem;
            line-height: 1.5;
            width: 280px;
            max-width: 90vw;
            box-sizing: border-box;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 3000;
            backdrop-filter: blur(5px);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.4);
            word-wrap: break-word;
        }
        #tooltip.visible { opacity: 1; }
        #tooltip h4 { margin: 8px 0 4px; color: var(--gold); font-size: 1rem; }
        #tooltip p { margin: 4px 0; }

        /* æ–°å¢ï¼šå·¦å´é¸å–® */
        #deckPanelToggle {
            position: fixed; left: 10px; top: 50%; transform: translateY(-50%);
            padding: 10px 15px; background: rgba(0,0,0,0.7); color: var(--gold);
            border: 1px solid var(--gold); border-radius: 0 10px 10px 0;
            cursor: pointer; z-index: 400; writing-mode: vertical-rl; font-size: 1.2rem;
            backdrop-filter: blur(5px);
        }
        #deckPanel {
            position: fixed; left: -300px; top: 0; width: 300px; height: 100%; background: rgba(0,0,0,0.9);
            border-right: 1px solid var(--gold); z-index: 350; transition: left 0.4s ease;
            padding: 20px; box-sizing: border-box; overflow-y: auto; backdrop-filter: blur(10px);
        }
        #deckPanel.open { left: 0; }
        #deckPanel h3 { color: var(--gold); margin: 20px 0 10px; text-align: center; }
        #deckPanel .card-btn {
            display: block; width: 100%; margin: 5px 0; padding: 8px;
            background: rgba(212,175,55,0.2); color: #e0e0e0; border: 1px solid var(--gold);
            border-radius: 8px; cursor: pointer; text-align: left; font-size: 0.9rem;
        }
        #deckPanel .card-btn:hover { background: var(--gold); color: #000; }
    </style>
</head>
<body>
    <div class="stars-container" id="stars"></div>
    <div id="mainCanvas">
        <div class="controls">
            <h2 style="margin:0; color:var(--gold); letter-spacing: 2px; text-shadow: 0 0 8px rgba(212,175,55,0.5);">é³¥å’ªæ‰˜ç‰¹æŠ½ç‰Œ TAROT</h2>
            <p id="hint" style="margin:5px 0; color: #aaa; font-size: 0.9rem;">é»æ“Šç‰Œå †å±•é–‹ (é›™æŒ‡æ‹–å‹•/ç¸®æ”¾æ¡Œé¢)</p>
            <button class="btn-reset" onclick="resetGame()">é‡æ–°æ´—ç‰Œ</button>
        </div>
        <div class="table" id="cardTable"></div>
        <div class="slot-container">
            <div class="slot"></div>
            <div class="slot"></div>
            <div class="slot"></div>
        </div>
    </div>
    <div id="tooltip"></div>

    <!-- æ–°å¢ï¼šå·¦å´é¸å–® -->
    <div id="deckPanelToggle">é¸ç‰Œ</div>
    <div id="deckPanel">
        <h3>å¤§é˜¿å¡ç´</h3>
        <!-- å¤§é˜¿å¡ç´æŒ‰éˆ•å°‡ç”± JS å‹•æ…‹ç”¢ç”Ÿ -->
        <h3>æ¬Šæ–çµ„</h3>
        <!-- æ¬Šæ–æŒ‰éˆ• -->
        <h3>è–æ¯çµ„</h3>
        <!-- è–æ¯æŒ‰éˆ• -->
        <h3>å¯¶åŠçµ„</h3>
        <!-- å¯¶åŠæŒ‰éˆ• -->
        <h3>åœ“ç›¤çµ„</h3>
        <!-- åœ“ç›¤æŒ‰éˆ• -->
    </div>

    <script>
        const thothCards = ["0 æ„šè€…", "I é­”è¡“å¸«", "II å¥³æ•™çš‡", "III çš‡å", "IV çš‡å¸", "V æ•™çš‡", "VI æˆ€äºº", "VII æˆ°è»Š", "VIII æ­£ç¾©", "IX éš±å£«", "X å‘½é‹ä¹‹è¼ª", "XI åŠ›é‡", "XII å€’åŠäºº", "XIII æ­»äº¡", "XIV ç¯€åˆ¶", "XV æƒ¡é­”", "XVI é«˜å¡”", "XVII æ˜Ÿæ˜Ÿ", "XVIII æœˆäº®", "XIX å¤ªé™½", "XX æ°¸æ†", "XXI å®‡å®™", "æ¬Šæ–é¨å£«", "æ¬Šæ–çš‡å", "æ¬Šæ–ç‹å­", "æ¬Šæ–å…¬ä¸»", "æ¬Šæ–1", "æ¬Šæ–2", "æ¬Šæ–3", "æ¬Šæ–4", "æ¬Šæ–5", "æ¬Šæ–6", "æ¬Šæ–7", "æ¬Šæ–8", "æ¬Šæ–9", "æ¬Šæ–10", "è–æ¯é¨å£«", "è–æ¯çš‡å", "è–æ¯ç‹å­", "è–æ¯å…¬ä¸»", "è–æ¯1", "è–æ¯2", "è–æ¯3", "è–æ¯4", "è–æ¯5", "è–æ¯6", "è–æ¯7", "è–æ¯8", "è–æ¯9", "è–æ¯10", "å¯¶åŠé¨å£«", "å¯¶åŠçš‡å", "å¯¶åŠç‹å­", "å¯¶åŠå…¬ä¸»", "å¯¶åŠ1", "å¯¶åŠ2", "å¯¶åŠ3", "å¯¶åŠ4", "å¯¶åŠ5", "å¯¶åŠ6", "å¯¶åŠ7", "å¯¶åŠ8", "å¯¶åŠ9", "å¯¶åŠ10", "åœ“ç›¤é¨å£«", "åœ“ç›¤çš‡å", "åœ“ç›¤ç‹å­", "åœ“ç›¤å…¬ä¸»", "åœ“ç›¤1", "åœ“ç›¤2", "åœ“ç›¤3", "åœ“ç›¤4", "åœ“ç›¤5", "åœ“ç›¤6", "åœ“ç›¤7", "åœ“ç›¤8", "åœ“ç›¤9", "åœ“ç›¤10"];

        const cardMeanings = {
            // (å®Œæ•´78å¼µç‰Œç¾©ç¶­æŒä½ çš„ç‰ˆæœ¬)
            "åœ“ç›¤é¨å£«": { general: "è²¬ä»»ã€æŒä¹…ã€å¯¦å‹™é ˜å°", work: "ç®¡ç†å¯¦å‹™", love: "é•·æœŸæ‰¿è«¾", health: "æŒä¹…åŠ›", reverse: "åœæ»¯" }
        };

        let deck = [...thothCards];
        const table = document.getElementById('cardTable');
        const mainCanvas = document.getElementById('mainCanvas');
        const hint = document.getElementById('hint');
        const tooltip = document.getElementById('tooltip');
        let isSpread = false;
        let selectedCount = 0;
        let hoverTimer = null;
        let isPanning = false, panOffsetX = 0, panOffsetY = 0, startX, startY;

        // é›»è…¦ä¸­éµå¹³ç§»èˆ‡æ‰‹æ©Ÿé›™æŒ‡å¹³ç§»ï¼ˆç¶­æŒåŸæ¨£ï¼‰
        window.addEventListener('mousedown', (e) => { if (e.button === 1) { e.preventDefault(); isPanning = true; document.body.style.cursor = 'move'; startX = e.clientX - panOffsetX; startY = e.clientY - panOffsetY; } });
        window.addEventListener('mousemove', (e) => { if (!isPanning) return; panOffsetX = e.clientX - startX; panOffsetY = e.clientY - startY; mainCanvas.style.transform = `translate(${panOffsetX}px, ${panOffsetY}px)`; });
        window.addEventListener('mouseup', (e) => { if (e.button === 1) { isPanning = false; document.body.style.cursor = 'default'; } });
        let initialMidX = 0, initialMidY = 0, initialOffsetX = 0, initialOffsetY = 0;
        mainCanvas.addEventListener('touchstart', (e) => {
            if (e.touches.length === 2) {
                const t1 = e.touches[0];
                const t2 = e.touches[1];
                initialMidX = (t1.clientX + t2.clientX) / 2;
                initialMidY = (t1.clientY + t2.clientY) / 2;
                initialOffsetX = panOffsetX;
                initialOffsetY = panOffsetY;
            }
        });
        mainCanvas.addEventListener('touchmove', (e) => {
            if (e.touches.length === 2) {
                e.preventDefault();
                const t1 = e.touches[0];
                const t2 = e.touches[1];
                const midX = (t1.clientX + t2.clientX) / 2;
                const midY = (t1.clientY + t2.clientY) / 2;
                panOffsetX = initialOffsetX + (midX - initialMidX);
                panOffsetY = initialOffsetY + (midY - initialMidY);
                mainCanvas.style.transform = `translate(${panOffsetX}px, ${panOffsetY}px)`;
            }
        });

        function createStars() {
            const container = document.getElementById('stars');
            for (let i = 0; i < 150; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                const size = Math.random() * 3;
                star.style.width = size + 'px';
                star.style.height = size + 'px';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.setProperty('--t', (2 + Math.random() * 4) + 's');
                container.appendChild(star);
            }
        }

        function getElementClass(cardName) {
            if (cardName.includes("è–æ¯")) return "cups";
            if (cardName.includes("æ¬Šæ–")) return "wands";
            if (cardName.includes("å¯¶åŠ")) return "swords";
            if (cardName.includes("åœ“ç›¤")) return "disks";
            return "major";
        }

        function showTooltip(card, x, y) {
            const cardName = card.querySelector('.card-front').textContent.trim();
            const meaning = cardMeanings[cardName] || { general: "ç‰Œç¾©æ•´ç†ä¸­...", work: "æ•´ç†ä¸­...", love: "æ•´ç†ä¸­...", health: "æ•´ç†ä¸­...", reverse: "æ•´ç†ä¸­..." };
            tooltip.innerHTML = `
                <strong style="color:var(--gold); font-size:1.1rem;">${cardName}</strong>
                <h4>ä¸€èˆ¬å«ç¾©</h4><p>${meaning.general}</p>
                <h4>å·¥ä½œ</h4><p>${meaning.work}</p>
                <h4>æ„Ÿæƒ…</h4><p>${meaning.love}</p>
                <h4>å¥åº·</h4><p>${meaning.health}</p>
                <h4>é€†ä½å«ç¾©</h4><p>${meaning.reverse}</p>
            `;
            tooltip.style.left = (x + 15) + 'px';
            tooltip.style.top = (y + 15) + 'px';
            tooltip.classList.add('visible');
        }

        function hideTooltip() {
            tooltip.classList.remove('visible');
            if (hoverTimer) clearTimeout(hoverTimer);
        }

        function initCards() {
            table.innerHTML = '';
            deck.sort(() => Math.random() - 0.5);
            for (let i = 0; i < 78; i++) {
                const card = document.createElement('div');
                card.className = 'card';
                card.style.zIndex = i;
                const elementClass = getElementClass(deck[i]);
                card.innerHTML = `<div class="card-face card-back"></div><div class="card-face card-front ${elementClass}">${deck[i]}</div>`;
                card.onclick = (e) => handleCardClick(card, e);
                card.addEventListener('mouseenter', (e) => {
                    if (card.classList.contains('selected') && !('ontouchstart' in window)) {
                        hoverTimer = setTimeout(() => showTooltip(card, e.clientX, e.clientY), 1000);
                    }
                });
                card.addEventListener('mouseleave', hideTooltip);
                card.addEventListener('mousemove', (e) => {
                    if (tooltip.classList.contains('visible')) {
                        tooltip.style.left = (e.clientX + 15) + 'px';
                        tooltip.style.top = (e.clientY + 15) + 'px';
                    }
                });
                card.addEventListener('touchend', (e) => {
                    if (card.classList.contains('selected')) {
                        e.preventDefault();
                        const touch = e.changedTouches[0];
                        if (tooltip.classList.contains('visible')) {
                            hideTooltip();
                        } else {
                            showTooltip(card, touch.clientX, touch.clientY);
                        }
                    }
                });
                table.appendChild(card);
            }
        }

        function handleCardClick(card, e) {
            if ('ontouchstart' in window && card.classList.contains('selected')) return;
            if (!isSpread) {
                const cards = document.querySelectorAll('.card');
                const radius = 350;
                cards.forEach((c, i) => {
                    const angle = ((i / 78) - 0.5) * 110;
                    const x = Math.sin(angle * Math.PI / 180) * radius;
                    const y = (1 - Math.cos(angle * Math.PI / 180)) * radius;
                    c.style.transform = `translateX(${x}px) translateY(${y}px) rotate(${angle}deg)`;
                });
                isSpread = true;
                hint.innerText = "è«‹æŠ½ç‰Œï¼Œé›™æŒ‡æ‹–å‹•/ç¸®æ”¾æ¡Œé¢";
            } else if (!card.classList.contains('selected')) {
                pickCard(card);
            }
        }

        function pickCard(card) {
            selectedCount++;
            card.classList.add('selected', 'flash');
            setTimeout(() => card.classList.remove('flash'), 300);
            const randomX = (Math.random() - 0.5) * 300;
            const randomY = 180 + Math.random() * 60;
            const randomRot = (Math.random() - 0.5) * 20;
            card.style.zIndex = 1000 + selectedCount;
            card.style.transform = `translate(${randomX}px, ${randomY}px) rotateY(180deg) rotateZ(${randomRot}deg)`;
            makeDraggable(card);
        }

        function resetGame() {
            hideTooltip();
            const cards = document.querySelectorAll('.card');
            isSpread = false; selectedCount = 0;
            panOffsetX = 0; panOffsetY = 0;
            mainCanvas.style.transform = `translate(0,0)`;
            cards.forEach((card, i) => {
                card.style.transform = `translate(0,0) rotate(0deg)`;
                card.style.zIndex = i;
                card.classList.remove('selected');
            });
            setTimeout(() => {
                cards.forEach((card, i) => {
                    const type = (i % 4) + 1;
                    card.classList.add(`sh-${type}`);
                    card.style.zIndex = Math.floor(Math.random() * 80);
                });
            }, 600);
            setTimeout(() => {
                cards.forEach(card => card.classList.remove('sh-1', 'sh-2', 'sh-3', 'sh-4'));
                initCards();
            }, 1800);
        }

        function makeDraggable(el) {
            let p1 = 0, p2 = 0, p3 = 0, p4 = 0;
            el.onmousedown = el.ontouchstart = (e) => {
                if (e.button === 1) return;
                const cx = e.touches ? e.touches[0].clientX : e.clientX;
                const cy = e.touches ? e.touches[0].clientY : e.clientY;
                el.classList.add('dragging');
                p3 = cx; p4 = cy;
                document.onmouseup = document.ontouchend = () => {
                    el.classList.remove('dragging');
                    document.onmouseup = document.onmousemove = document.ontouchend = document.ontouchmove = null;
                };
                document.onmousemove = document.ontouchmove = (ev) => {
                    const ncx = ev.touches ? ev.touches[0].clientX : ev.clientX;
                    const ncy = ev.touches ? ev.touches[0].clientY : ev.clientY;
                    p1 = p3 - ncx; p2 = p4 - ncy; p3 = ncx; p4 = ncy;
                    const matrix = new WebKitCSSMatrix(window.getComputedStyle(el).transform);
                    el.style.transform = `translate(${matrix.m41 - p1}px, ${matrix.m42 - p2}px) rotateY(180deg)`;
                };
            };
        }

        // æ–°å¢ï¼šå·¦å´é¸å–®åŠŸèƒ½
        const deckPanel = document.getElementById('deckPanel');
        const toggleBtn = document.getElementById('deckPanelToggle');

        toggleBtn.onclick = () => {
            deckPanel.classList.toggle('open');
        };

        // å‹•æ…‹ç”¢ç”Ÿé¸å–®æŒ‰éˆ•
        function createDeckButtons() {
            const major = thothCards.slice(0, 22);
            const wands = thothCards.filter(c => c.includes("æ¬Šæ–"));
            const cups = thothCards.filter(c => c.includes("è–æ¯"));
            const swords = thothCards.filter(c => c.includes("å¯¶åŠ"));
            const disks = thothCards.filter(c => c.includes("åœ“ç›¤"));

            const groups = [
                { title: "å¤§é˜¿å¡ç´", cards: major },
                { title: "æ¬Šæ–çµ„", cards: wands },
                { title: "è–æ¯çµ„", cards: cups },
                { title: "å¯¶åŠçµ„", cards: swords },
                { title: "åœ“ç›¤çµ„", cards: disks }
            ];

            groups.forEach(group => {
                const h3 = document.createElement('h3');
                h3.textContent = group.title;
                deckPanel.appendChild(h3);
                group.cards.forEach(name => {
                    const btn = document.createElement('button');
                    btn.className = 'card-btn';
                    btn.textContent = name;
                    btn.onclick = () => {
                        // å¾ç‰Œå †ä¸­æ‰¾å‡ºè©²ç‰Œä¸¦æŠ½å–
                        const cardElements = document.querySelectorAll('.card');
                        const targetCard = Array.from(cardElements).find(card => 
                            card.querySelector('.card-front').textContent.trim() === name
                        );
                        if (targetCard && !targetCard.classList.contains('selected')) {
                            pickCard(targetCard);
                        }
                        deckPanel.classList.remove('open'); // æŠ½å®Œè‡ªå‹•æ”¶åˆ
                    };
                    deckPanel.appendChild(btn);
                });
            });
        }

        createStars();
        initCards();
        createDeckButtons(); // ç”¢ç”Ÿé¸å–®æŒ‰éˆ•
    </script>
</body>
</html>
