<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=0.5, user-scalable=yes">
    <title>3D 托特塔羅：元素色彩版</title>
    <style>
        :root {
            --card-w: 80px; --card-h: 130px;
            --gold: #d4af37;
            --bg-major: #8A8A8A;
            --bg-cups: #1075B5;
            --bg-wands: #942712;
            --bg-disks: #AD7E28;
            --bg-swords: #2BCCC4;
        }
        @media (min-width: 768px) { :root { --card-w: 90px; --card-h: 145px; } }
        body {
            background: #020205; color: #e0e0e0; height: 100vh; margin: 0;
            overflow: hidden; font-family: "PingFang TC", sans-serif;
            display: flex; flex-direction: column; align-items: center;
            touch-action: pan-x pan-y pinch-zoom;
        }
        .stars-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%);
            z-index: -1;
        }
        .star { position: absolute; background: white; border-radius: 50%; opacity: 0.3; animation: twinkle var(--t) infinite ease-in-out; }
        @keyframes twinkle { 0%, 100% { opacity: 0.3; transform: scale(1); } 50% { opacity: 1; transform: scale(1.2); } }
        #mainCanvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center;
            will-change: transform; transition: transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .controls { margin-top: 2vh; text-align: center; z-index: 100; }
        .btn-reset {
            margin-top: 10px; padding: 8px 25px; background: rgba(0,0,0,0.6);
            color: var(--gold); border: 1px solid var(--gold); cursor: pointer;
            border-radius: 30px; transition: 0.3s; backdrop-filter: blur(5px);
        }
        .btn-reset:hover { background: var(--gold); color: #000; box-shadow: 0 0 15px var(--gold); }
        .table { position: relative; width: 100vw; height: 250px; perspective: 1200px; display: flex; justify-content: center; align-items: center; margin-top: 10px; }
        .slot-container { display: flex; gap: 30px; margin-top: 20px; z-index: 1; pointer-events: none; }
        .slot { width: var(--card-w); height: var(--card-h); border: 1px dashed rgba(212, 175, 55, 0.3); border-radius: 8px; }
        .card {
            position: absolute; width: var(--card-w); height: var(--card-h);
            cursor: grab; transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.23, 1, 0.32, 1), filter 0.3s;
            touch-action: none;
            -webkit-tap-highlight-color: transparent;
        }
        .card.flash { filter: brightness(1.8) drop-shadow(0 0 10px #fff); }
        .card-face { position: absolute; width: 100%; height: 100%; border-radius: 8px; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; text-align: center; padding: 12px; box-sizing: border-box; }
        .card-back { background: #0f0f1a; border: 1px solid #333; }
        .card-back::after { content: "✺"; color: var(--gold); opacity: 0.4; font-size: 30px; }
        .card-front {
            color: #111; transform: rotateY(180deg);
            font-weight: bold; font-size: 1rem; border: 4px double var(--gold);
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            animation: gold-breathe 3s infinite ease-in-out;
        }
        .card-front.major { background: var(--bg-major); }
        .card-front.cups { background: var(--bg-cups); }
        .card-front.wands { background: var(--bg-wands); }
        .card-front.disks { background: var(--bg-disks); }
        .card-front.swords { background: var(--bg-swords); }
        @keyframes gold-breathe {
            0%, 100% { border-color: var(--gold); box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
            50% { border-color: #fff7d1; box-shadow: 0 0 20px rgba(212, 175, 55, 0.8); }
        }
        .dragging { transition: none !important; z-index: 2000 !important; }

        /* 牌義視窗優化：固定寬度、字小一點、允許換行 */
        #tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.85);
            color: #e0e0e0;
            padding: 12px 16px;
            border-radius: 10px;
            border: 1px solid var(--gold);
            font-size: 0.8rem;         /* 字小一點 */
            line-height: 1.5;
            width: 280px;              /* 固定寬度，避免變細長 */
            max-width: 90vw;           /* 手機上最多佔90%螢幕寬 */
            box-sizing: border-box;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 3000;
            backdrop-filter: blur(5px);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.4);
            word-wrap: break-word;     /* 長句自動換行 */
        }
        #tooltip.visible { opacity: 1; }
        #tooltip h4 { margin: 8px 0 4px; color: var(--gold); font-size: 1rem; }
        #tooltip p { margin: 4px 0; }

        @keyframes shuffle1 { 0%, 100% { transform: translate(0, 0) rotate(0); } 50% { transform: translate(-120px, -10px) rotate(-12deg); } }
        @keyframes shuffle2 { 0%, 100% { transform: translate(0, 0) rotate(0); } 50% { transform: translate(120px, 5px) rotate(15deg); } }
        @keyframes shuffle3 { 0%, 100% { transform: translate(0, 0) rotate(0); } 50% { transform: translate(-70px, 15px) rotate(-8deg); } }
        @keyframes shuffle4 { 0%, 100% { transform: translate(0, 0) rotate(0); } 50% { transform: translate(70px, -15px) rotate(10deg); } }
        .sh-1 { animation: shuffle1 0.4s ease-in-out infinite; }
        .sh-2 { animation: shuffle2 0.4s ease-in-out infinite; }
        .sh-3 { animation: shuffle3 0.4s ease-in-out infinite; }
        .sh-4 { animation: shuffle4 0.4s ease-in-out infinite; }
    </style>
</head>
<body>
    <div class="stars-container" id="stars"></div>
    <div id="mainCanvas">
        <div class="controls">
            <h2 style="margin:0; color:var(--gold); letter-spacing: 2px; text-shadow: 0 0 8px rgba(212,175,55,0.5);">鳥咪托特抽牌 TAROT</h2>
            <p id="hint" style="margin:5px 0; color: #aaa; font-size: 0.9rem;">點擊牌堆展開 (雙指拖動/縮放桌面)</p>
            <button class="btn-reset" onclick="resetGame()">重新洗牌</button>
        </div>
        <div class="table" id="cardTable"></div>
        <div class="slot-container">
            <div class="slot"></div>
            <div class="slot"></div>
            <div class="slot"></div>
        </div>
    </div>
    <div id="tooltip"></div>

    <script>
        // thothCards 和 cardMeanings 完整內容（維持上次完整版）

        const thothCards = ["0 愚者", "I 魔術師", "II 女教皇", "III 皇后", "IV 皇帝", "V 教皇", "VI 戀人", "VII 戰車", "VIII 正義", "IX 隱士", "X 命運之輪", "XI 力量", "XII 倒吊人", "XIII 死亡", "XIV 節制", "XV 惡魔", "XVI 高塔", "XVII 星星", "XVIII 月亮", "XIX 太陽", "XX 永恆", "XXI 宇宙", "權杖騎士", "權杖皇后", "權杖王子", "權杖公主", "權杖1", "權杖2", "權杖3", "權杖4", "權杖5", "權杖6", "權杖7", "權杖8", "權杖9", "權杖10", "聖杯騎士", "聖杯皇后", "聖杯王子", "聖杯公主", "聖杯1", "聖杯2", "聖杯3", "聖杯4", "聖杯5", "聖杯6", "聖杯7", "聖杯8", "聖杯9", "聖杯10", "寶劍騎士", "寶劍皇后", "寶劍王子", "寶劍公主", "寶劍1", "寶劍2", "寶劍3", "寶劍4", "寶劍5", "寶劍6", "寶劍7", "寶劍8", "寶劍9", "寶劍10", "圓盤騎士", "圓盤皇后", "圓盤王子", "圓盤公主", "圓盤1", "圓盤2", "圓盤3", "圓盤4", "圓盤5", "圓盤6", "圓盤7", "圓盤8", "圓盤9", "圓盤10"];

        const cardMeanings = { /* 上次完整的 78 張牌義，保持不變 */ };

        let deck = [...thothCards];
        const table = document.getElementById('cardTable');
        const mainCanvas = document.getElementById('mainCanvas');
        const hint = document.getElementById('hint');
        const tooltip = document.getElementById('tooltip');
        let isSpread = false;
        let selectedCount = 0;
        let hoverTimer = null;

        let isPanning = false, panOffsetX = 0, panOffsetY = 0, startX, startY;

        // 電腦中鍵平移（維持原樣）
        window.addEventListener('mousedown', (e) => { if (e.button === 1) { e.preventDefault(); isPanning = true; document.body.style.cursor = 'move'; startX = e.clientX - panOffsetX; startY = e.clientY - panOffsetY; } });
        window.addEventListener('mousemove', (e) => { if (!isPanning) return; panOffsetX = e.clientX - startX; panOffsetY = e.clientY - startY; mainCanvas.style.transform = `translate(${panOffsetX}px, ${panOffsetY}px)`; });
        window.addEventListener('mouseup', (e) => { if (e.button === 1) { isPanning = false; document.body.style.cursor = 'default'; } });

        // 手機單指平移：只在沒點到牌時才觸發（解決拖牌時畫面晃動）
        let touchStartX = 0, touchStartY = 0, touchedElement = null;
        mainCanvas.addEventListener('touchstart', (e) => {
            if (e.touches.length === 1) {
                touchedElement = document.elementFromPoint(e.touches[0].clientX, e.touches[0].clientY);
                if (touchedElement && touchedElement.classList.contains('card')) {
                    // 點到牌 → 不觸發平移，讓牌可以被拖曳或點擊
                    return;
                }
                touchStartX = e.touches[0].clientX - panOffsetX;
                touchStartY = e.touches[0].clientY - panOffsetY;
            }
        }, { passive: true });

        mainCanvas.addEventListener('touchmove', (e) => {
            if (e.touches.length === 1 && touchedElement && !touchedElement.classList.contains('card')) {
                e.preventDefault();
                panOffsetX = e.touches[0].clientX - touchStartX;
                panOffsetY = e.touches[0].clientY - touchStartY;
                mainCanvas.style.transform = `translate(${panOffsetX}px, ${panOffsetY}px)`;
            }
        }, { passive: false });

        // 其餘函數（createStars, getElementClass, showTooltip, hideTooltip, initCards, handleCardClick, pickCard, resetGame, makeDraggable）完全不變

        createStars();
        initCards();
    </script>
</body>
</html>
